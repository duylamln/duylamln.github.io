(function(t){function e(e){for(var n,i,o=e[0],c=e[1],u=e[2],l=0,d=[];l<o.length;l++)i=o[l],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&d.push(s[i][0]),s[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);p&&p(e);while(d.length)d.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var t,e=0;e<a.length;e++){for(var r=a[e],n=!0,i=1;i<r.length;i++){var o=r[i];0!==s[o]&&(n=!1)}n&&(a.splice(e--,1),t=c(c.s=r[0]))}return t}var n={},i={app:0},s={app:0},a=[];function o(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-40f4cc33":"0821b0bd","chunk-53869b30":"f22b1325","chunk-60bac8b0":"ec8bc75c"}[t]+".js"}function c(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.e=function(t){var e=[],r={"chunk-53869b30":1};i[t]?e.push(i[t]):0!==i[t]&&r[t]&&e.push(i[t]=new Promise((function(e,r){for(var n="css/"+({}[t]||t)+"."+{"chunk-40f4cc33":"31d6cfe0","chunk-53869b30":"8d6a4e2b","chunk-60bac8b0":"31d6cfe0"}[t]+".css",s=c.p+n,a=document.getElementsByTagName("link"),o=0;o<a.length;o++){var u=a[o],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===n||l===s))return e()}var d=document.getElementsByTagName("style");for(o=0;o<d.length;o++){u=d[o],l=u.getAttribute("data-href");if(l===n||l===s)return e()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=e,p.onerror=function(e){var n=e&&e.target&&e.target.src||s,a=new Error("Loading CSS chunk "+t+" failed.\n("+n+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=n,delete i[t],p.parentNode.removeChild(p),r(a)},p.href=s;var m=document.getElementsByTagName("head")[0];m.appendChild(p)})).then((function(){i[t]=0})));var n=s[t];if(0!==n)if(n)e.push(n[2]);else{var a=new Promise((function(e,r){n=s[t]=[e,r]}));e.push(n[2]=a);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=o(t);var d=new Error;u=function(e){l.onerror=l.onload=null,clearTimeout(p);var r=s[t];if(0!==r){if(r){var n=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+n+": "+i+")",d.name="ChunkLoadError",d.type=n,d.request=i,r[1](d)}s[t]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(e)},c.m=t,c.c=n,c.d=function(t,e,r){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(r,n,function(e){return t[e]}.bind(null,n));return r},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/chemistorder/",c.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=e,u=u.slice();for(var d=0;d<u.length;d++)e(u[d]);var p=l;a.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"01e5":function(t,e,r){"use strict";var n=r("8927"),i=r.n(n);i.a},"06f4":function(t,e,r){},"0846":function(t,e,r){},1:function(t,e){},2:function(t,e){},3:function(t,e){},"316d":function(t,e,r){},"3a20":function(t,e,r){"use strict";var n=r("316d"),i=r.n(n);i.a},4295:function(t,e,r){},"56d7":function(t,e,r){"use strict";r.r(e);r("96cf");var n=r("3b8d"),i=(r("7514"),r("1c4c"),r("8a81"),r("f466"),r("579f"),r("587a"),r("a026")),s=r("5f5b"),a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("router-view")},o=[],c={name:"app"},u=c,l=(r("5c0b"),r("2877")),d=Object(l["a"])(u,a,o,!1,null,null,null),p=d.exports,m=r("8c4f"),h=r("8aa5"),f=r.n(h),v=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[r("i",{staticClass:"fa fa-book"}),t._v(" Products ("+t._s(t.productCount)+") ")]),r("div",{staticClass:"pull-right"},[r("b-link",{on:{click:t.clearAllSalePrices}},[t._v("Clear Sale Prices")]),r("b-link",{staticClass:"mr-1 ml-1"},[t._v("|")]),r("b-link",{on:{click:t.addNewProduct}},[t._v("Add New Product")])],1)]),r("b-row",[r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-input-group",{staticClass:"mb-5"},[r("b-form-input",{on:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.seartTextKeydown(e):null}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),r("b-input-group-append",[""!=t.searchText?r("span",{staticClass:"fa fa-close",attrs:{id:"searchclear"},on:{click:t.clearSearchText}}):t._e(),r("b-button",{attrs:{variant:"outline-success"},on:{click:function(e){return t.clickSearchProduct()}}},[r("span",{staticClass:"fa fa-search"}),t._v(" Search ")])],1)],1)],1)],1),r("view-port",{scopedSlots:t._u([{key:"mobile",fn:function(){return[r("products-list-mobile",{attrs:{products:t.products,"search-text":t.searchText},on:{productClicked:t.productClicked,deleteProduct:t.deleteProduct,editProduct:t.editProduct}})]},proxy:!0},{key:"desktop",fn:function(){return[r("products-list",{attrs:{products:t.products,"search-text":t.searchText},on:{productClicked:t.productClicked,deleteProduct:t.deleteProduct,editProduct:t.editProduct}})]},proxy:!0}])}),r("b-row",{staticClass:"load-more"},[r("b-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingMore,expression:"isLoadingMore"}],attrs:{variant:"outline-success"},on:{click:function(e){return t.loadMoreProduct(e)}}},[t._v("Load more")])],1)],1)],1)],1),r("product-detail",{ref:"productDetail",on:{"product-saved":t.productSaved}})],1)},b=[],g=(r("28a5"),r("20d6"),r("7f7f"),r("ac6a"),r("cebc")),y=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{attrs:{id:t.intId,title:"Product Detail - "+(t.prod.id||""),size:"lg","modal-class":"product-detail-modal"},on:{ok:t.saveProduct}},[r("b-alert",{attrs:{show:"",variant:"warning"}},[t._v(t._s(t.readonly?"It will not update into Product master data.":"Product master data will be updated."))]),r("cw-product-predictive",{directives:[{name:"show",rawName:"v-show",value:"CW"==t.supplierPredictive,expression:"supplierPredictive == 'CW'"}],ref:"cwProductPredictive",on:{productMatched:t.updateMatchedProduct}}),r("pa-product-predictive",{directives:[{name:"show",rawName:"v-show",value:"PA"==t.supplierPredictive,expression:"supplierPredictive == 'PA'"}],ref:"paProductPredictive",on:{productMatched:t.updateMatchedProduct}}),r("b-row",[r("b-col",{attrs:{sm:"8"}},[r("b-form-group",[r("label",{attrs:{for:"name"}},[t._v("Name")]),r("b-form-input",{attrs:{type:"text",placeholder:"Enter product name"},model:{value:t.prod.name,callback:function(e){t.$set(t.prod,"name",e)},expression:"prod.name"}}),r("b-link",{on:{click:function(e){return t.checkCwMatchedProduct(!0)}}},[t._v("Chemist Warehouse Search")]),r("b-link",{staticClass:"mr-1 ml-1"},[t._v("|")]),r("b-link",{on:{click:function(e){return t.checkPaMatchedProduct(!0)}}},[t._v("Pandora Search")]),t.existedProduct?r("div",[r("i",{staticStyle:{color:"red"}},[t._v(" * Product existed: "),r("b-link",{on:{click:t.openExistedProduct}},[t._v(t._s(t.existedProduct.name))])],1)]):t._e()],1),r("b-form-group",[r("label",{attrs:{for:"name"}},[t._v("Thumbnail Url")]),r("b-form-input",{attrs:{type:"text",placeholder:"Enter product image url"},model:{value:t.prod.thumbnail,callback:function(e){t.$set(t.prod,"thumbnail",e)},expression:"prod.thumbnail"}})],1)],1),r("b-col",{attrs:{sm:"4"}},[r("div",{staticClass:"card"},[r("img",{staticStyle:{margin:"auto"},attrs:{src:t.prod.thumbnail,alt:t.prod.name,width:"150px",height:"150px"}})])])],1),t._l(t.prod.supplierPrices,(function(e,n){return[r("b-form-group",{key:n},[r("b-row",[r("b-col",{attrs:{sm:"3"}},[r("b-form-select",{attrs:{options:t.suppliers},model:{value:e.supplier,callback:function(r){t.$set(e,"supplier",r)},expression:"sp.supplier"}})],1),r("b-col",{attrs:{sm:"2"}},[r("b-form-input",{attrs:{type:"number",placeholder:"Price (A$)"},model:{value:e.price,callback:function(r){t.$set(e,"price",r)},expression:"sp.price"}})],1),r("b-col",{attrs:{sm:"3"}},[r("b-input-group",[r("b-form-input",{attrs:{type:"number",placeholder:"Sale Price (A$)"},model:{value:e.salePrice,callback:function(r){t.$set(e,"salePrice",r)},expression:"sp.salePrice"}}),r("b-input-group-append",{attrs:{"is-text":""}},[r("b-form-checkbox",{on:{change:function(e){return t.salePricePickChanged(n,e)}},model:{value:e.salePricePick,callback:function(r){t.$set(e,"salePricePick",r)},expression:"sp.salePricePick"}})],1)],1)],1),r("b-col",{attrs:{sm:"1"}},[r("b-link",{on:{click:function(e){return t.removeSupplierPrice(n)}}},[r("i",{staticClass:"fa fa-times text-danger fa-lg",staticStyle:{"padding-top":"12px"},attrs:{"aria-hidden":"true"}})])],1),r("b-col",{staticStyle:{"padding-top":"7px"},attrs:{sm:"1"}},[e.id?r("strong",[t._v("#"+t._s(e.id))]):t._e()])],1)],1)]})),r("b-form-group",[r("b-link",{on:{click:t.addSuppplierPrice}},[t._v("Add Supplier Price")])],1),r("b-row",[r("b-col",{attrs:{sm:"2"}},[r("b-form-group",[r("label",{attrs:{for:"weight"}},[t._v("Weight (g)")]),r("b-link",{staticClass:"ml-2",on:{click:t.searchShipppingWeight}},[t._v("Search")]),r("b-form-input",{attrs:{type:"number",id:"weight",placeholder:"0"},model:{value:t.prod.weight,callback:function(e){t.$set(t.prod,"weight",e)},expression:"prod.weight"}})],1)],1),r("b-col",{attrs:{sm:"2"}},[r("b-form-group",[r("label",{attrs:{for:"shipprice"}},[t._v("Shipment Price (A$)")]),r("b-form-input",{attrs:{type:"number",id:"shipprice",placeholder:"0.00",disabled:!0},model:{value:t.prod.shipPrice,callback:function(e){t.$set(t.prod,"shipPrice",e)},expression:"prod.shipPrice"}})],1)],1),r("b-col",{attrs:{sm:"4"}},[r("b-form-group",[r("label",{attrs:{for:"selprice"}},[t._v("Selling Price (A$)")]),r("b-form-input",{attrs:{type:"number",id:"selprice",placeholder:"0.00",disabled:!0},model:{value:t.prod.selPrice,callback:function(e){t.$set(t.prod,"selPrice",e)},expression:"prod.selPrice"}})],1)],1),r("b-col",{attrs:{sm:"4"}},[r("b-form-group",[r("label",{attrs:{for:"buyprice"}},[t._v("Buying Price (A$)")]),r("b-form-input",{attrs:{type:"number",id:"buyprice",placeholder:"0.00",disabled:!0},model:{value:t.prod.buyPrice,callback:function(e){t.$set(t.prod,"buyPrice",e)},expression:"prod.buyPrice"}})],1)],1)],1),r("b-row",[r("b-col",{attrs:{sm:"4"}},[r("b-form-group",{attrs:{description:"Buy. Price + Ship"}},[r("label",{attrs:{for:"oriprice"}},[t._v("Ori. Price (A$)")]),t._v(" - "),r("vnd-price",{attrs:{value:t.prod.oriPrice}}),r("b-form-input",{attrs:{type:"number",id:"oriprice",placeholder:"0.00",disabled:!0},model:{value:t.prod.oriPrice,callback:function(e){t.$set(t.prod,"oriPrice",e)},expression:"prod.oriPrice"}})],1)],1),r("b-col",{attrs:{sm:"4"}},[r("b-form-group",{attrs:{description:"Sel. Price + Commission(10%) + Ship + $2"}},[r("label",{attrs:{for:"sugprice"}},[t._v(" Sug. Price (A$) - "),r("vnd-price",{attrs:{value:t.prod.sugPrice}})],1),r("b-form-input",{attrs:{placeholder:"0.00",disabled:!0},model:{value:t.prod.sugPrice,callback:function(e){t.$set(t.prod,"sugPrice",e)},expression:"prod.sugPrice"}})],1)],1),r("b-col",{attrs:{sm:"4"}},[r("b-form-group",[r("label",{attrs:{for:"rndprice"}},[t._v(" Rnd. Price (VND) - "),r("i",{staticStyle:{color:"red"}},[t._v(t._s(t._f("currency")(t.prod.rndPrice,t.vndConfig)))])]),r("b-form-input",{attrs:{type:"number",placeholder:"0.00"},model:{value:t.prod.rndPrice,callback:function(e){t.$set(t.prod,"rndPrice",e)},expression:"prod.rndPrice"}})],1)],1)],1)],2)},C=[],k=(r("a481"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticStyle:{color:"red"}},[r("i",[t._v(t._s(t._f("currency")(t.display,t.vndConfig)))])])}),w=[],P={name:"vndPrice",props:["value"],mounted:function(){},computed:{display:function(){return parseFloat(this.value)*parseFloat(this.appSettings.vndExchangeRate)}}},x=P,S=Object(l["a"])(x,k,w,!1,null,null,null),I=S.exports;r("c5f6");function O(t){var e=t.split(" "),r=[];return e.forEach((function(t){var e="";t.split("").forEach((function(t){e+=t.toLowerCase(),r.push(e)}))})),r}Date.prototype.setMin=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Number.prototype.roundTo=function(t){return Math.round(this*Number("1e"+t))/Number("1e"+t)},String.prototype.format||(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,(function(e,r){return"undefined"!=typeof t[r]?t[r]:e}))});var $=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.enable?r("b-row",[r("b-col",{attrs:{sm:"12"}},[r("div",{staticClass:"alert alert-primary",attrs:{role:"alert"}},[t.isChecking?[r("div",{staticClass:"spinner-border spinner-border-sm text-success",attrs:{role:"status"}},[r("span",{staticClass:"sr-only"})]),t._v(" "),r("strong",{staticStyle:{"margin-right":"20px"}},[t._v("Chemist Warehouse")]),t._v(' searching "'+t._s(t.term)+'"... ')]:t._e(),!t.isChecking&&t.term.length>0?[t.matchedProducts&&0==t.matchedProducts.length?[r("strong",{staticStyle:{"margin-right":"20px"}},[t._v("Chemist Warehouse")]),t._v(' Search result of "'+t._s(t.term)+'"": 0 item(s) found on '+t._s(t._f("date")(t.lastChecked))+" ")]:[r("div",[r("p",[r("strong",{staticStyle:{"margin-right":"20px"}},[t._v("Chemist Warehouse")]),t._v(' Search result of "'+t._s(t.term)+'"": '+t._s(t.matchedProducts.length)+" item(s) found on "+t._s(t._f("date")(t.lastChecked))+" ")]),r("table",{staticClass:"table table-borderless"},t._l(t.matchedProducts,(function(e,n){return r("tr",{key:n},[r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("td",{staticStyle:{width:"10%"}},[t._v("#"+t._s(e.id))]),r("td",[t._v(t._s(e.label))]),r("td",{staticStyle:{width:"20%"}},[0!=e.oldPrice?r("small",[r("del",[t._v(t._s(t._f("currency")(e.oldPrice,t.audConfig)))])]):t._e(),t._v(" "+t._s(t._f("currency")(e.price,t.audConfig))+" "),"increase"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-up fa-lg",staticStyle:{color:"red"},attrs:{"aria-hidden":"true"}}):t._e(),"decrease"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-down fa-lg",staticStyle:{color:"green"},attrs:{"aria-hidden":"true"}}):t._e(),e.percentage>0?r("span",[t._v("("+t._s(e.percentage)+"%)")]):t._e()]),r("td",{staticClass:"text-right",staticStyle:{width:"10%"}},[r("b-button",{attrs:{type:"submit",size:"sm",variant:"success",disabled:t.selected.id==e.id},on:{click:function(r){return t.matchProduct(e)}}},[r("i",{staticClass:"fa fa-check"}),t._v(" Select ")])],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("td",{staticStyle:{width:"100%"}},[t._v(" "+t._s(n+1)+". "+t._s(e.label)+" (#"+t._s(e.id)+") - "),r("small",[r("del",[t._v(t._s(t._f("currency")(e.oldPrice,t.audConfig)))])]),t._v(" "+t._s(t._f("currency")(e.price,t.audConfig))+" "),"increase"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-up fa-lg",staticStyle:{color:"red"},attrs:{"aria-hidden":"true"}}):t._e(),"decrease"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-down fa-lg",staticStyle:{color:"green"},attrs:{"aria-hidden":"true"}}):t._e(),t._v(" ("+t._s(e.percentage)+"%) "),r("br"),r("b-button",{attrs:{type:"submit",size:"sm",variant:"success",disabled:t.selected.id==e.id},on:{click:function(r){return t.matchProduct(e)}}},[r("i",{staticClass:"fa fa-check"}),t._v(" Select ")])],1)]},proxy:!0}],null,!0)})],1)})),0)])]]:t._e()],2)])],1):t._e()},T=[];i["default"].appSettings;var D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.useMobileView?t._t("mobile",[t._v("This is mobile view")]):t._e(),t.useMobileView?t._e():t._t("desktop",[t._v("This is desktop view")])],2)},E=[],M={name:"viewPort",props:[],data:function(){return{useMobileView:!1,innerWidth:0}},mounted:function(){var t=this;t.useMobileView=window.innerWidth<700,t.innerWidth=window.innerWidth,window.addEventListener("resize",(function(){t.useMobileView=window.innerWidth<700,t.innerWidth=window.innerWidth}))},computed:{}},j=M,q=Object(l["a"])(j,D,E,!1,null,null,null),R=q.exports,F={name:"cwProductPredictive",components:{viewPort:R},props:[],data:function(){return{matchedProducts:[],isChecking:!1,hasChanged:!1,product:{},lastChecked:void 0,selected:{},term:""}},mounted:function(){},watch:{},computed:{enable:function(){return this.appSettings.enableCWProductPredictive}},methods:{checkPrice:function(t,e){var r=this;if(this.enable&&(this.product=t,this.selected={},this.matchedProducts=[],this.product&&this.product.name)){var n=(new Date).setMin(),i=this.product,s=i.name,a=i.cwTracking,o=this.product.supplierPrices&&this.product.supplierPrices.find((function(t){return"CW"==t.supplier})),c=o&&o.id;if(this.term=c||s,!e&&a&&a.lastChecked&&a.lastChecked.toDate()>n)return this.matchedProducts.push({supplier:"CW",id:(this.product.supplierPrices.find((function(t){return"CW"==t.supplier}))||{}).id,priceStatus:a.priceStatus,price:a.price,oldPrice:a.oldPrice,percentage:a.percentage,label:this.product.name}),void(this.lastChecked=a.lastChecked.toDate());this.isChecking=!0,this.hasChanged=!1,this.callCWCheckPriceApi(this.term).then((function(t){if(t&&200==t.status&&t.data){var e=t.data,n=_.filter(e,(function(t){return parseFloat(t.id)>0}));n&&(n=_.map(n,r.decorateData),n.forEach((function(t){return r.matchedProducts.push(t)}))),r.hasChanged=_.some(r.matchedProducts,{hasChanged:!0})}r.lastChecked=new Date,r.isChecking=!1}))}},callCWCheckPriceApi:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get(this.appSettings.cwCheckPriceApi.replace("{term}",e));case 2:if(r=t.sent,!(r&&200==r.status&&r.data&&(0==r.data.length||r.data.indexOf("No results")>-1))){t.next=9;break}if(!(e.indexOf("'s")>-1)){t.next=9;break}return e=e.replace("'s",""),t.next=8,this.$http.get(this.appSettings.cwCheckPriceApi.replace("{term}",e));case 8:r=t.sent;case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),decorateData:function(t){t.price=parseFloat(t.Price),t.thumbnail=this.appSettings.cwProductThumbnailUrl150.replace("{id}",t.id);var e=t.price;this.product.supplierPrices&&0!=this.product.supplierPrices.length||(this.product.supplierPrices=[],this.product.supplierPrices.push({supplier:"CW"}));var r=this.product.supplierPrices.find((function(t){return"CW"==t.supplier})),n=parseFloat(r&&r.price||0);return t.supplier="CW",t.oldPrice=n,0==n?(t.priceStatus="same",t.percentage=0):e>n+.5?(t.priceStatus="increase",t.percentage=((e-n)/n*100).toFixed(0)):e<n-.5?(t.priceStatus="decrease",t.percentage=((n-e)/n*100).toFixed(0)):(t.priceStatus="same",t.percentage=0),t.hasChanged=t.thumbnail!=this.product.thumbnail||"same"!=t.priceStatus,t},matchProduct:function(t){this.selected=t,this.$emit("productMatched",Object(g["a"])({},t))}}},A=F,L=Object(l["a"])(A,$,T,!1,null,null,null),B=L.exports,N=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.enable?r("b-row",[r("b-col",{attrs:{sm:"12"}},[r("div",{staticClass:"alert alert-primary",attrs:{role:"alert"}},[t.isChecking?[r("div",{staticClass:"spinner-border spinner-border-sm text-success",attrs:{role:"status"}},[r("span",{staticClass:"sr-only"})]),t._v(" "),r("strong",{staticStyle:{"margin-right":"20px"}},[t._v("Pandora")]),t._v(' searching "'+t._s(t.term)+'"... ')]:t._e(),!t.isChecking&&t.term.length>0?[t.matchedProducts&&0==t.matchedProducts.length?[r("strong",{staticStyle:{"margin-right":"20px"}},[t._v("Pandora")]),t._v(' Search result of "'+t._s(t.term)+'"": 0 item(s) found on '+t._s(t._f("date")(t.lastChecked))+" ")]:[r("div",[r("p",[r("strong",{staticStyle:{"margin-right":"20px"}},[t._v("Pandora")]),t._v(' Search result of "'+t._s(t.term)+'"": '+t._s(t.matchedProducts.length)+" item(s) found on "+t._s(t._f("date")(t.lastChecked))+" ")]),r("table",{staticClass:"table table-borderless"},t._l(t.matchedProducts,(function(e,n){return r("tr",{key:n},[r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("td",{staticStyle:{width:"20%"}},[t._v("#"+t._s(e.id))]),r("td",[t._v(t._s(e.label))]),r("td",{staticStyle:{width:"20%"}},[0!=e.oldPrice&&"same"!=e.priceStatus?r("small",[r("del",[t._v(t._s(t._f("currency")(e.oldPrice,t.audConfig)))])]):t._e(),t._v(" "+t._s(t._f("currency")(e.price,t.audConfig))+" "),"increase"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-up fa-lg",staticStyle:{color:"red"},attrs:{"aria-hidden":"true"}}):t._e(),"decrease"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-down fa-lg",staticStyle:{color:"green"},attrs:{"aria-hidden":"true"}}):t._e(),e.percentage>0?r("span",[t._v("("+t._s(e.percentage)+"%)")]):t._e()]),r("td",{staticClass:"text-right",staticStyle:{width:"10%"}},[r("b-button",{attrs:{type:"submit",size:"sm",variant:"success",disabled:t.selected.id==e.id},on:{click:function(r){return t.matchProduct(e)}}},[r("i",{staticClass:"fa fa-check"}),t._v(" Select ")])],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("td",{staticStyle:{width:"100%"}},[t._v(" "+t._s(n+1)+". "+t._s(e.label)+" (#"+t._s(e.id)+") - "),r("small",[r("del",[t._v(t._s(t._f("currency")(e.oldPrice,t.audConfig)))])]),t._v(" "+t._s(t._f("currency")(e.price,t.audConfig))+" "),"increase"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-up fa-lg",staticStyle:{color:"red"},attrs:{"aria-hidden":"true"}}):t._e(),"decrease"==e.priceStatus?r("i",{staticClass:"fa fa-angle-double-down fa-lg",staticStyle:{color:"green"},attrs:{"aria-hidden":"true"}}):t._e(),t._v(" ("+t._s(e.percentage)+"%) "),r("br"),r("b-button",{attrs:{type:"submit",size:"sm",variant:"success",disabled:t.selected.id==e.id},on:{click:function(r){return t.matchProduct(e)}}},[r("i",{staticClass:"fa fa-check"}),t._v(" Select ")])],1)]},proxy:!0}],null,!0)})],1)})),0)])]]:t._e()],2)])],1):t._e()},V=[],Q=r("aa46"),z=r("618f"),W=z.group,H=z.text,U=(z.number,z.href,z.src,z.uniq,z.attr),Y=z.data,K={name:"PAProductPredictive",components:{viewPort:R},props:[],data:function(){return{matchedProducts:[],isChecking:!1,product:{},lastChecked:void 0,selected:{},term:""}},mounted:function(){},watch:{},computed:{enable:function(){return this.appSettings.enablePAProductPredictive}},methods:{checkPrice:function(t,e){var r=this;if(this.enable&&(this.product=t,this.selected={},this.matchedProducts=[],this.product&&this.product.name)){var n=(new Date).setMin(),i=this.product,s=i.name,a=i.paTracking,o=this.product.supplierPrices&&this.product.supplierPrices.find((function(t){return"PA"==t.supplier})),c=o&&o.id;if(this.term=c||s,!e&&a&&a.lastChecked&&a.lastChecked.toDate()>n)return this.matchedProducts.push({supplier:"PA",id:c,priceStatus:a.priceStatus,price:a.price,oldPrice:a.oldPrice,percentage:a.percentage,label:this.product.name}),void(this.lastChecked=a.lastChecked.toDate());this.isChecking=!0,this.callPACheckPriceApi(this.term).then((function(t){if(t&&200==t.status&&t.data){var e=r.parseHtml2Json(t.data);if(e&&e.length>0){var n=_.map(e,r.decorateData);n.forEach((function(t){return r.matchedProducts.push(t)}))}}r.lastChecked=new Date,r.isChecking=!1}))}},parseHtml2Json:function(t){var e=Q(t,{paProducts:W(".Search-suggestion__product",{url:Y(":self","url"),imgSrc:U("img","src"),label:H(".search-suggestion-right-panel-product-name"),priceRange:U(".pricerange input[type=hidden]","value"),prices:U(".product-price input[class*=price]","value"),saleprice:U(".product-price input[class*=saleprice]","value"),stdprice:U(".product-price input[class*=stdprice]","value")})});return console.log(e),e.paProducts},callPACheckPriceApi:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=this.appSettings.paProductGetSuggestion.replace("{q}",e),t.next=3,this.$http.get(r);case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),decorateData:function(t){t.id=t.url&&t.url.substring(t.url.lastIndexOf("/")+1).replace(".html",""),t.price=parseFloat(t.saleprice),t.thumbnail=t.imgSrc;var e=t.price;this.product.supplierPrices&&0!=this.product.supplierPrices.length||(this.product.supplierPrices=[],this.product.supplierPrices.push({supplier:"PA"}));var r=this.product.supplierPrices.find((function(t){return"PA"==t.supplier})),n=parseFloat(r&&r.price||0);return t.supplier="PA",t.oldPrice=n,0==n?(t.priceStatus="same",t.percentage=0):e>n+.5?(t.priceStatus="increase",t.percentage=((e-n)/n*100).toFixed(0)):e<n-.5?(t.priceStatus="decrease",t.percentage=((n-e)/n*100).toFixed(0)):(t.priceStatus="same",t.percentage=0),t},matchProduct:function(t){this.selected=t,this.$emit("productMatched",Object(g["a"])({},t))}}},G=K,J=Object(l["a"])(G,N,V,!1,null,null,null),X=J.exports,Z=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"vdpComponent",class:{vdpWithInput:t.hasInputElement},staticStyle:{width:"100%"}},[t.hasInputElement?r("input",t._b({staticClass:"form-control",attrs:{type:"text",readonly:t.isReadOnly},domProps:{value:t.inputValue},on:{input:function(e){t.editable&&t.processUserInput(e.target.value)},focus:function(e){t.editable&&t.open()},click:function(e){t.editable&&t.open()}}},"input",t.inputAttributes,!1)):t._e(),t.editable&&t.hasInputElement&&t.inputValue?r("button",{staticClass:"vdpClearInput",attrs:{type:"button"},on:{click:t.clear}}):t._e(),r("transition",{attrs:{name:"vdp-toggle-calendar"}},[t.opened?r("div",{ref:"outerWrap",staticClass:"vdpOuterWrap",class:[t.positionClass,{vdpFloating:t.hasInputElement}],on:{click:t.closeViaOverlay}},[r("div",{staticClass:"vdpInnerWrap"},[r("header",{staticClass:"vdpHeader"},[r("button",{staticClass:"vdpArrow vdpArrowPrev",attrs:{title:t.prevMonthCaption,type:"button"},on:{click:function(e){return t.incrementMonth(-1)}}},[t._v(t._s(t.prevMonthCaption))]),r("button",{staticClass:"vdpArrow vdpArrowNext",attrs:{type:"button",title:t.nextMonthCaption},on:{click:function(e){return t.incrementMonth(1)}}},[t._v(t._s(t.nextMonthCaption))]),r("div",{staticClass:"vdpPeriodControls"},[r("div",{staticClass:"vdpPeriodControl"},[r("button",{key:t.currentPeriod.month,class:t.directionClass,attrs:{type:"button"}},[t._v(t._s(t.months[t.currentPeriod.month]))]),r("select",{directives:[{name:"model",rawName:"v-model",value:t.currentPeriod.month,expression:"currentPeriod.month"}],on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.currentPeriod,"month",e.target.multiple?r:r[0])}}},t._l(t.months,(function(e,n){return r("option",{key:e,domProps:{value:n}},[t._v(t._s(e))])})),0)]),r("div",{staticClass:"vdpPeriodControl"},[r("button",{key:t.currentPeriod.year,class:t.directionClass,attrs:{type:"button"}},[t._v(t._s(t.currentPeriod.year))]),r("select",{directives:[{name:"model",rawName:"v-model",value:t.currentPeriod.year,expression:"currentPeriod.year"}],on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.currentPeriod,"year",e.target.multiple?r:r[0])}}},t._l(t.yearRange,(function(e){return r("option",{key:e,domProps:{value:e}},[t._v(t._s(e))])})),0)])])]),r("table",{staticClass:"vdpTable"},[r("thead",[r("tr",t._l(t.weekdaysSorted,(function(e){return r("th",{key:e,staticClass:"vdpHeadCell"},[r("span",{staticClass:"vdpHeadCellContent"},[t._v(t._s(e))])])})),0)]),r("tbody",{key:t.currentPeriod.year+"-"+t.currentPeriod.month,class:t.directionClass},t._l(t.currentPeriodDates,(function(e,n){return r("tr",{key:n,staticClass:"vdpRow"},t._l(e,(function(e){return r("td",{key:e.dateKey,staticClass:"vdpCell",class:{selectable:!e.disabled,selected:e.selected,disabled:e.disabled,today:e.today,outOfRange:e.outOfRange},attrs:{"data-id":e.dateKey},on:{click:function(r){return t.selectDateItem(e)}}},[r("div",{staticClass:"vdpCellContent"},[t._v(t._s(e.date.getDate()))])])})),0)})),0)]),t.pickTime&&t.currentTime?r("div",{staticClass:"vdpTimeControls"},[r("span",{staticClass:"vdpTimeCaption"},[t._v(t._s(t.setTimeCaption))]),r("div",{staticClass:"vdpTimeUnit"},[r("pre",[r("span",[t._v(t._s(t.currentTime.hoursPadded))]),r("br")]),r("input",{staticClass:"vdpHoursInput",attrs:{type:"number",pattern:"\\d*"},domProps:{value:t.currentTime.hoursPadded},on:{input:function(e){return e.preventDefault(),t.inputTime("setHours",e)}}})]),t.pickMinutes?r("span",{staticClass:"vdpTimeSeparator"},[t._v(":")]):t._e(),t.pickMinutes?r("div",{staticClass:"vdpTimeUnit"},[r("pre",[r("span",[t._v(t._s(t.currentTime.minutesPadded))]),r("br")]),t.pickMinutes?r("input",{staticClass:"vdpMinutesInput",attrs:{type:"number",pattern:"\\d*"},domProps:{value:t.currentTime.minutesPadded},on:{input:function(e){return t.inputTime("setMinutes",e)}}}):t._e()]):t._e(),t.pickSeconds?r("span",{staticClass:"vdpTimeSeparator"},[t._v(":")]):t._e(),t.pickSeconds?r("div",{staticClass:"vdpTimeUnit"},[r("pre",[r("span",[t._v(t._s(t.currentTime.secondsPadded))]),r("br")]),t.pickSeconds?r("input",{staticClass:"vdpSecondsInput",attrs:{type:"number",pattern:"\\d*"},domProps:{value:t.currentTime.secondsPadded},on:{input:function(e){return t.inputTime("setSeconds",e)}}}):t._e()]):t._e()]):t._e()])]):t._e()])],1)},tt=[],et=(r("6b54"),r("768b")),rt=(r("4917"),/,|\.|-| |:|\/|\\/),nt=/D+/,it=/M+/,st=/Y+/,at=/h+/i,ot=/m+/,ct=/s+/,ut={props:{value:{type:String,default:""},format:{type:String,default:"YYYY-MM-DD"},displayFormat:{type:String},editable:{type:Boolean,default:!0},hasInputElement:{type:Boolean,default:!0},inputAttributes:{type:Object},selectableYearRange:{type:Number,default:40},parseDate:{type:Function},formatDate:{type:Function},pickTime:{type:Boolean,default:!1},pickMinutes:{type:Boolean,default:!0},pickSeconds:{type:Boolean,default:!1},isDateDisabled:{type:Function,default:function(){return!1}},nextMonthCaption:{type:String,default:"Next month"},prevMonthCaption:{type:String,default:"Previous month"},setTimeCaption:{type:String,default:"Set time:"},mobileBreakpointWidth:{type:Number,default:500},weekdays:{type:Array,default:function(){return["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]}},months:{type:Array,default:function(){return["January","February","March","April","May","June","July","August","September","October","November","December"]}},startWeekOnSunday:{type:Boolean,default:!1}},data:function(){return{inputValue:this.valueToInputFormat(this.value),currentPeriod:this.getPeriodFromValue(this.value,this.format),direction:void 0,positionClass:void 0,opened:!this.hasInputElement}},computed:{valueDate:function(){var t=this.value,e=this.format;return t?this.parseDateString(t,e):void 0},isReadOnly:function(){return!this.editable||this.inputAttributes&&this.inputAttributes.readonly},isValidValue:function(){var t=this.valueDate;return!this.value||Boolean(t)},currentPeriodDates:function(){var t=this,e=this.currentPeriod,r=e.year,n=e.month,i=[],s=new Date(r,n,1),a=new Date,o=this.startWeekOnSunday?1:0,c=s.getDay()||7;if(c>1-o)for(var u=c-(2-o);u>=0;u--){var l=new Date(s);l.setDate(-u),i.push({outOfRange:!0,date:l})}while(s.getMonth()===n)i.push({date:new Date(s)}),s.setDate(s.getDate()+1);for(var d=7-i.length%7,p=1;p<=d;p++){var m=new Date(s);m.setDate(p),i.push({outOfRange:!0,date:m})}return i.forEach((function(e){e.disabled=t.isDateDisabled(e.date),e.today=pt(e.date,a),e.dateKey=[e.date.getFullYear(),e.date.getMonth()+1,e.date.getDate()].join("-"),e.selected=!!t.valueDate&&pt(e.date,t.valueDate)})),dt(i,7)},yearRange:function(){for(var t=[],e=this.currentPeriod.year,r=e-this.selectableYearRange,n=e+this.selectableYearRange,i=r;i<=n;i++)t.push(i);return t},currentTime:function(){var t=this.valueDate;return t?{hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds(),hoursPadded:lt(t.getHours(),1),minutesPadded:lt(t.getMinutes(),2),secondsPadded:lt(t.getSeconds(),2)}:void 0},directionClass:function(){return this.direction?"vdp".concat(this.direction,"Direction"):void 0},weekdaysSorted:function(){if(this.startWeekOnSunday){var t=this.weekdays.slice();return t.unshift(t.pop()),t}return this.weekdays}},watch:{value:function(t){this.isValidValue&&(this.inputValue=this.valueToInputFormat(t),this.currentPeriod=this.getPeriodFromValue(t,this.format))},currentPeriod:function(t,e){var r=new Date(t.year,t.month).getTime(),n=new Date(e.year,e.month).getTime();this.direction=r!==n?r>n?"Next":"Prev":void 0}},beforeDestroy:function(){this.removeCloseEvents(),this.teardownPosition()},methods:{valueToInputFormat:function(t){return this.displayFormat&&this.formatDateToString(this.parseDateString(t,this.format),this.displayFormat)||t},getPeriodFromValue:function(t,e){var r=this.parseDateString(t,e)||new Date;return{month:r.getMonth(),year:r.getFullYear()}},parseDateString:function(t,e){return t?this.parseDate?this.parseDate(t,e):this.parseSimpleDateString(t,e):void 0},formatDateToString:function(t,e){return t?this.formatDate?this.formatDate(t,e):this.formatSimpleDateToString(t,e):""},parseSimpleDateString:function(t,e){for(var r,n,i,s,a,o,c=t.split(rt),u=e.split(rt),l=u.length,d=0;d<l;d++)u[d].match(nt)?r=parseInt(c[d],10):u[d].match(it)?n=parseInt(c[d],10):u[d].match(st)?i=parseInt(c[d],10):u[d].match(at)?s=parseInt(c[d],10):u[d].match(ot)?a=parseInt(c[d],10):u[d].match(ct)&&(o=parseInt(c[d],10));var p=new Date([lt(i,4),lt(n,2),lt(r,2)].join("-"));if(!isNaN(p)){var m=new Date(i,n-1,r);return[[i,"setFullYear"],[s,"setHours"],[a,"setMinutes"],[o,"setSeconds"]].forEach((function(t){var e=Object(et["a"])(t,2),r=e[0],n=e[1];"undefined"!==typeof r&&m[n](r)})),m}},formatSimpleDateToString:function(t,e){return e.replace(st,(function(e){return t.getFullYear()})).replace(it,(function(e){return lt(t.getMonth()+1,e.length)})).replace(nt,(function(e){return lt(t.getDate(),e.length)})).replace(at,(function(e){return lt(t.getHours(),e.length)})).replace(ot,(function(e){return lt(t.getMinutes(),e.length)})).replace(ct,(function(e){return lt(t.getSeconds(),e.length)}))},incrementMonth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=new Date(this.currentPeriod.year,this.currentPeriod.month),r=new Date(e.getFullYear(),e.getMonth()+t);this.currentPeriod={month:r.getMonth(),year:r.getFullYear()}},processUserInput:function(t){var e=this.parseDateString(t,this.displayFormat||this.format);this.inputValue=t,this.$emit("input",e?this.formatDateToString(e,this.format):t)},open:function(){this.opened||(this.opened=!0,this.currentPeriod=this.getPeriodFromValue(this.value,this.format),this.addCloseEvents(),this.setupPosition()),this.direction=void 0},close:function(){this.opened&&(this.opened=!1,this.direction=void 0,this.removeCloseEvents(),this.teardownPosition())},closeViaOverlay:function(t){this.hasInputElement&&t.target===this.$refs.outerWrap&&this.close()},addCloseEvents:function(){var t=this;this.closeEventListener||(this.closeEventListener=function(e){return t.inspectCloseEvent(e)},["click","keyup"].forEach((function(e){return document.addEventListener(e,t.closeEventListener)})))},inspectCloseEvent:function(t){t.keyCode?27===t.keyCode&&this.close():t.target===this.$el||this.$el.contains(t.target)||this.close()},removeCloseEvents:function(){var t=this;this.closeEventListener&&(["click","keyup"].forEach((function(e){return document.removeEventListener(e,t.closeEventListener)})),delete this.closeEventListener)},setupPosition:function(){var t=this;this.positionEventListener||(this.positionEventListener=function(){return t.positionFloater()},window.addEventListener("resize",this.positionEventListener)),this.positionFloater()},positionFloater:function(){var t=this,e=this.$el.getBoundingClientRect(),r="vdpPositionTop",n="vdpPositionLeft",i=function(){var i=t.$refs.outerWrap.getBoundingClientRect(),s=i.height,a=i.width;window.innerWidth>t.mobileBreakpointWidth?(e.top+e.height+s>window.innerHeight&&e.top-s>0&&(r="vdpPositionBottom"),e.left+a>window.innerWidth&&(n="vdpPositionRight"),t.positionClass=["vdpPositionReady",r,n].join(" ")):t.positionClass="vdpPositionFixed"};this.$refs.outerWrap?i():this.$nextTick(i)},teardownPosition:function(){this.positionEventListener&&(this.positionClass=void 0,window.removeEventListener("resize",this.positionEventListener),delete this.positionEventListener)},clear:function(){this.$emit("input","")},selectDateItem:function(t){if(!t.disabled){var e=new Date(t.date);this.currentTime&&(e.setHours(this.currentTime.hours),e.setMinutes(this.currentTime.minutes),e.setSeconds(this.currentTime.seconds)),this.$emit("input",this.formatDateToString(e,this.format)),this.hasInputElement&&!this.pickTime&&this.close()}},inputTime:function(t,e){var r=this.valueDate,n={setHours:23,setMinutes:59,setSeconds:59},i=parseInt(e.target.value,10)||0;i>n[t]?i=n[t]:i<0&&(i=0),e.target.value=lt(i,"setHours"===t?1:2),r[t](i),this.$emit("input",this.formatDateToString(r,this.format))}}};function lt(t,e){return"undefined"!==typeof t?t.toString().length>e?t:new Array(e-t.toString().length+1).join("0")+t:void 0}function dt(t,e){var r=[];while(t.length)r.push(t.splice(0,e));return r}function pt(t,e){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}var mt,ht,ft,vt,bt,gt,yt,_t,Ct,kt=ut,wt=(r("8f38"),Object(l["a"])(kt,Z,tt,!1,null,null,null)),Pt=wt.exports,xt=r("2f62"),St={name:"ProductDetail",components:{vndPrice:I,cwProductPredictive:B,DatePick:Pt,paProductPredictive:X},props:["id","readonly"],data:function(){return{prod:{},cwMatchedProduct:{},cwMatchedProductChange:!1,isCheckingCwPrice:!1,settings:{},supplierPredictive:"",existedProduct:void 0}},mounted:function(){this.settings=this.appSettings},watch:{"prod.supplierPrices":{deep:!0,handler:function(t){this.calculatePrices(t)}},"prod.weight":function(t){t&&parseFloat(t)>=0&&(this.prod.shipPrice=(parseFloat(t)*this.settings.shipPricePerKg/1e3).roundTo(2),this.calculateItself())}},computed:{intId:function(){return this.id||"productdetail"},suppliers:function(){return this.settings&&this.settings.suppliers&&0!=this.settings.suppliers.length?this.settings.suppliers.map((function(t){return{text:t.name,value:t.code}})):[]}},methods:Object(g["a"])({},Object(xt["b"])("counter",["increaseProductCount"]),{open:function(t){var e=this;t?(this.prod=Object(g["a"])({},t),this.prod.supplierPrices=[],t.supplierPrices&&t.supplierPrices.length>0&&t.supplierPrices.forEach((function(t){return e.prod.supplierPrices.push(t)}))):this.prod={name:"",thumbnail:"",weight:0,shipPrice:0,selPrice:0,buyPrice:0,oriPrice:0,sugPrice:0,rndPrice:0,supplierPrices:[]},this.$bvModal.show(this.intId),this.$nextTick((function(){if(e.prod.supplierPrices){var t=e.prod.supplierPrices.find((function(t){return"CW"==t.supplier}));t&&t.id&&e.checkCwMatchedProduct();var r=e.prod.supplierPrices.find((function(t){return"PA"==t.supplier}));r&&r.id&&e.checkPaMatchedProduct()}}))},saveProduct:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,r,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.prod,e.name){t.next=3;break}return t.abrupt("return");case 3:if(e.nameSearch=O(e.name),!this.readonly){t.next=8;break}return this.$emit("productSaved",Object(g["a"])({},e)),this.$bvModal.hide(this.intId),t.abrupt("return");case 8:if(!e.id){t.next=12;break}return t.abrupt("return",this.$fb.productCollection.doc(e.id).set(e).then((function(){return n.$emit("product-saved",Object(g["a"])({},e)),n.$bvModal.hide(n.intId),n.showMessage("Product updated!"),e})));case 12:return r=this.$fb.productCollection.doc(),e.id=r.id,t.abrupt("return",r.set(e).then((function(){return n.increaseProductCount(),n.$emit("product-saved",Object(g["a"])({},e)),n.$bvModal.hide(n.intId),n.showMessage("Product created!"),e})));case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getExistingProductByName:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.$fb.productCollection.where("name","==",e).limit(1).get().then((function(t){return t.empty?void 0:t.docs[0].data()})));case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),calculatePrices:function(t){console.log("calculate Prices");var e=this.prod.weight;if(this.prod.shipPrice=(parseFloat(e||0)*this.settings.shipPricePerKg/1e3).roundTo(2),t&&0!=t.length){this.prod.selPrice=_.maxBy(t,(function(t){return parseFloat(t.price||0)})).price,this.prod.buyPrice=_.minBy(t,(function(t){return parseFloat(t.price||9999)})).price,this.calculateItself();var r=this.prod.supplierPrices.find((function(t){return t.salePricePick}));r&&(this.prod.selPrice=r.salePrice,this.prod.buyPrice=r.salePrice,this.calculateItself())}},calculateItself:function(){console.log("calculate itself"),this.prod.oriPrice=(parseFloat(this.prod.shipPrice)+parseFloat(this.prod.buyPrice)).toFixed(2),this.prod.sugPrice=parseFloat(this.prod.shipPrice+this.prod.selPrice*this.settings.commissionRate+this.settings.buyingFee).toFixed(2),this.prod.sugPriceVND=parseFloat(this.prod.sugPrice*this.settings.vndExchageRate).toFixed(2)},salePricePickChanged:function(t,e){var r=this;console.log("sale price pick change"),e&&this.prod.supplierPrices.forEach((function(t,e){t.salePricePick=!1,r.prod.supplierPrices.splice(e,1,t)}));var n=this.prod.supplierPrices[t];n.salePricePick=e,this.prod.supplierPrices.splice(t,1,n)},updateMatchedProduct:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n,i,s,a,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.thumbnail,n=e.id,e.priceStatus,i=e.price,s=e.label,a=e.supplier,this.prod.name=s,this.prod.thumbnail?r&&r!=this.prod.thumbnail&&(this.prod.thumbnail=r):this.$set(this.prod,"thumbnail",r),this.prod.supplierPrices||this.$set(this.prod,"supplierPrices",new Array),o=this.prod.supplierPrices.findIndex((function(t){return t.supplier==a})),-1==o?this.prod.supplierPrices.push({supplier:a,id:n,price:i,salePrice:"",salePricePick:!1}):(c=this.prod.supplierPrices[o],c.price=i,c.id=n,this.prod.supplierPrices.splice(o,1,c)),t.next=8,this.getExistingProductByName(this.prod.name);case 8:this.existedProduct=t.sent;case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),checkCwMatchedProduct:function(t){this.existedProduct=void 0,this.supplierPredictive="CW",this.$refs.cwProductPredictive.checkPrice(this.prod,t)},checkPaMatchedProduct:function(t){this.existedProduct=void 0,this.supplierPredictive="PA",this.$refs.paProductPredictive.checkPrice(this.prod,t)},searchShipppingWeight:function(){var t="https://www.google.com.au/search?source=hp&ei=b54BXsjALoiW4-EPl8izwA4&q={term}&oq={term}&gs_l=psy-ab.3...9077.14394..15665...1.0..0.238.3323.0j15j3......0....2j1..gws-wiz.......33i21j33i10.9gohnIlLrZE&ved=0ahUKEwiItLOew83mAhUIyzgGHRfkDOgQ4dUDCAg&uact=5",e=this.prod.name+" "+"shipping weight".replace(" ","+");t=t.replace("{term}",e);var r=window.open(t,"_blank");r.focus()},addSuppplierPrice:function(){this.prod.supplierPrices||this.$set(this.prod,"supplierPrices",new Array),this.prod.supplierPrices.push({supplier:"",price:"",salePrice:""})},removeSupplierPrice:function(t){var e=this;this.$bvModal.msgBoxConfirm("Are you sure you want to delete this supplier price ?").then(function(){var r=Object(n["a"])(regeneratorRuntime.mark((function r(n){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n&&e.prod.supplierPrices.splice(t,1);case 1:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()).catch((function(t){console.log(t)}))},openExistedProduct:function(){this.open(this.existedProduct)}})},It=St,Ot=Object(l["a"])(It,y,C,!1,null,"1a20182c",null),$t=Ot.exports,Tt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-table",{ref:"productTable",attrs:{responsive:"sm",items:t.items,fields:t.fields,small:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.productClicked,"row-dblclicked":t.productDoubleClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(name)",fn:function(e){return[r("div",{staticClass:"prod-thumbnail-name"},[r("div",{staticClass:"thumbnail"},[e.item.thumbnail?r("img",{attrs:{src:e.item.thumbnail,width:"50px",height:"50px"}}):t._e()]),r("div",{staticClass:"name-2"},[r("text-highlight",{attrs:{queries:t.queries}},[t._v(t._s(e.value))])],1)])]}},{key:"cell(weight)",fn:function(e){return[r("strong",[t._v(t._s(e.item.weight)+"(g)")]),t._v(" - "+t._s(t._f("currency")(e.item.shipPrice,t.audConfig))+" ")]}},{key:"cell(tempPrices)",fn:function(t){return[r("show-supplier-prices",{attrs:{product:t.item}})]}},{key:"cell(rndPrice)",fn:function(e){return[r("span",{staticClass:"price"},[t._v(t._s(t._f("currency")(e.item.rndPrice,t.vndConfig)))]),e.item.bvSalePricePick?r("b-badge",{attrs:{variant:"success"}},[t._v("BV Sale")]):t._e(),e.item.cwSalePricePick?r("b-badge",{attrs:{variant:"success"}},[t._v("CW Sale")]):t._e(),16500*e.item.sugPrice>e.item.rndPrice?r("b-badge",{attrs:{variant:"warning"}},[t._v("Recheck")]):t._e(),r("br"),r("small",[t._v("Sug. Price: "+t._s(t._f("currency")(e.item.sugPrice,t.audConfig))+" - "+t._s(t._f("currency")(16500*e.item.sugPrice,t.vndConfig)))])]}},{key:"cell(action)",fn:function(e){return[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editProduct(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteProduct(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])]}}])})},Dt=[],Et=r("b50c"),Mt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.product.supplierPrices&&0!=t.product.supplierPrices.length?r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[t._l(t.product.supplierPrices,(function(e,n){return[n>0?r("span",{staticClass:"price-gutter"},[t.breakline?r("br"):t._e(),t.breakline?t._e():r("span")]):t._e(),r("span",{key:n},[e.salePricePick?t._e():r("span",[r("strong",[t._v(t._s(e.supplier)+":")]),t._v(" "+t._s(t._f("currency")(e.price,t.audConfig))+" ")]),e.salePricePick?r("span",[r("strong",[t._v(t._s(e.supplier)+":")]),r("del",[t._v(t._s(t._f("currency")(e.price,t.audConfig)))]),r("span",[t._v(t._s(t._f("currency")(e.salePrice,t.audConfig)))]),r("b-badge",{staticStyle:{"margin-left":"3px"},attrs:{variant:"success"}},[t._v("Sale")])],1):t._e()])]}))]},proxy:!0},{key:"mobile",fn:function(){return[t._l(t.product.supplierPrices,(function(e,n){return[r("div",{key:n},[e.salePricePick?t._e():r("span",[r("strong",[t._v(t._s(e.supplier)+":")]),t._v(" "+t._s(t._f("currency")(e.price,t.audConfig))+" ")]),e.salePricePick?r("span",[r("strong",[t._v(t._s(e.supplier)+":")]),r("del",[t._v(t._s(t._f("currency")(e.price,t.audConfig)))]),r("span",[t._v(t._s(t._f("currency")(e.salePrice,t.audConfig)))]),r("b-badge",{staticStyle:{"margin-left":"3px"},attrs:{variant:"success"}},[t._v("Sale")])],1):t._e()])]}))]},proxy:!0}])}):r("span",{staticStyle:{color:"red"}},[t._v("Missing supplier prices")])],1)},jt=[],qt={name:"ShowSupplierPrices",components:{viewPort:R},props:["product","breakline"],data:function(){return{}},mounted:function(){},watch:{},computed:{},methods:{}},Rt=qt,Ft=(r("9e87"),Object(l["a"])(Rt,Mt,jt,!1,null,"2283091b",null)),At=Ft.exports,Lt={name:"ProductsListMobile",components:{TextHighlight:Et["a"],ShowSupplierPrices:At},props:["products","searchText"],data:function(){return{fields:[{key:"index",label:"#"},{key:"name",class:"name"},{key:"weight",label:"Weight (g)",class:"weight"},{key:"tempPrices",label:"Temp. Prices",class:"temp-price"},{key:"rndPrice",label:"Price",class:"rnd-price"},{key:"action",label:"Action",class:"action"}]}},mounted:function(){},computed:{items:function(){return this.products||[]},queries:function(){var t=this.searchText.split(" ").filter((function(t){return""!=t}));return t}},methods:{productClicked:function(t){this.$emit("productClicked",t)},deleteProduct:function(t){this.$emit("deleteProduct",t)},editProduct:function(t){this.$emit("editProduct",t),this.$refs.productTable.selectRow(t.index)},productDoubleClicked:function(t,e){var r={item:t,index:e};this.editProduct(r)}}},Bt=Lt,Nt=(r("6b63"),Object(l["a"])(Bt,Tt,Dt,!1,null,null,null)),Vt=Nt.exports,Qt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-table",{ref:"productTable",attrs:{responsive:"sm",items:t.items,fields:t.fields,small:!0},on:{"row-clicked":t.productClicked,"row-dblclicked":t.productDoubleClicked},scopedSlots:t._u([{key:"cell(name)",fn:function(e){return[r("div",{staticClass:"row"},[r("div",{staticClass:"col-4",staticStyle:{overflow:"hidden"}},[r("img",{staticStyle:{"margin-left":"-30px"},attrs:{src:e.item.thumbnail,width:"150px",height:"150px"}})]),r("div",{staticClass:"col-8"},[r("strong",[r("text-highlight",{attrs:{queries:t.queries}},[t._v(t._s(e.item.name))])],1),r("br"),r("strong",[t._v("Weight:")]),t._v(" "+t._s(e.item.weight)+"(g) - "+t._s(t._f("currency")(e.item.shipPrice,t.audConfig))+" "),r("br"),r("show-supplier-prices",{attrs:{product:e.item}}),r("span",{staticClass:"h4"},[r("strong",[t._v("Price")]),t._v(" : "+t._s(t._f("currency")(e.item.rndPrice,t.vndConfig))+" ")]),r("div",{staticStyle:{"margin-top":"7px"}},[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editProduct(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteProduct(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])],1)],1)])]}}])})},zt=[],Wt={name:"ProductsList",components:{ShowSupplierPrices:At},props:[],extends:Vt,data:function(){return{fields:[{key:"name",label:"",class:""}]}},mounted:function(){},computed:{},methods:{}},Ht=Wt,Ut=Object(l["a"])(Ht,Qt,zt,!1,null,null,null),Yt=Ut.exports,Kt={name:"Products",components:{productDetail:$t,productsList:Vt,productsListMobile:Yt,viewPort:R},data:function(){return{products:[],product:{},productBatches:"",useMobileView:!1,searchText:"",pageSize:20,lastVisible:void 0,isLoadingMore:!1,saleProductCount:0,saleProducts:[]}},mounted:function(){var t=this;t.useMobileView=window.innerWidth<700,window.addEventListener("resize",(function(){t.useMobileView=window.innerWidth<700})),this.loadProducts()},watch:{searchText:function(t,e){""!=e&&""==t&&(this.products=[],this.loadProducts())}},computed:Object(g["a"])({},Object(xt["c"])("counter",{productCount:function(t){return t.counter&&t.counter.productCount}})),methods:Object(g["a"])({},Object(xt["b"])("counter",["increaseProductCount","decreaseProductCount"]),{loadProducts:function(t){var e=this;return this.isLoadingMore=!0,this.$fb.productCollection.orderBy("name").startAfter(this.lastVisible||0).limit(this.pageSize).get().then((function(t){e.isLoadingMore=!1,t.empty||(e.lastVisible=_.last(t.docs),t.forEach((function(t){e.products.push(t.data())})))}))},loadMoreProduct:function(t){var e=this;this.isLoadingMore=!0,this.searchText?this.searchProduct(this.lastVisible).then((function(){return e.isLoadingMore=!1})):this.loadProducts(this.lastVisible).then((function(){return e.isLoadingMore=!1}))},productClicked:function(t){this.product=Object(g["a"])({},t)},deleteProduct:function(t){var e=this,r=t.item,n=t.index;r&&this.$bvModal.msgBoxConfirm("Are you sure you want to delete [".concat(r.name,"]?")).then((function(t){t&&e.$fb.productCollection.doc(r.id).delete().then((function(){e.products.splice(n,1),e.decreaseProductCount()}))})).catch((function(t){console.log(t)}))},addNewProduct:function(){this.product=void 0,this.selectedIndex=void 0,this.$refs.productDetail.open(void 0)},productSaved:function(t){void 0!=this.selectedIndex?this.products.splice(this.selectedIndex,1,t):this.products.push(t)},editProduct:function(t){var e=t.index,r=t.item;this.product=Object(g["a"])({},r),this.selectedIndex=e,this.$refs.productDetail.open(this.product)},updateDataBatches:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$fb.productCollection.get().then((function(t){return t.docs.map((function(t){return t.data()}))}));case 2:e=t.sent,console.log(e),e.forEach((function(t){if(t.cwProductId){var e=t.supplierPrices&&t.supplierPrices.findIndex((function(t){return"CW"==t.supplier}));e>-1&&(t.supplierPrices[e].id=t.cwProductId,delete t.cwProductId)}if(t.paProductId){var r=t.supplierPrices&&t.supplierPrices.findIndex((function(t){return"PA"==t.supplier}));r>-1&&(t.supplierPrices[r].id=t.paProductId,delete t.paProductId)}})),console.log(e);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),clickSearchProduct:function(){this.products=[],this.searchProduct()},searchProduct:function(t){var e=this;if(this.searchText){var r=this.searchText.split(" ").filter((function(t){return""!=t}));return this.$fb.productCollection.where("nameSearch","array-contains-any",r).orderBy("name").startAfter(t||0).limit(this.pageSize).get().then((function(t){t.empty||(e.lastVisible=_.last(t.docs),t.forEach((function(t){e.products.push(t.data())})))}))}},seartTextKeydown:function(t){this.products=[],this.searchProduct()},clearSearchText:function(){this.searchText=""},checkCwPrice:function(){},clearAllSalePrices:function(){var t=this;this.$fb.productCollection.where("cwSalePricePick","==",!0).get().then((function(e){e.empty||(t.saleProductCount=e.docs.length,t.saleProductCount>0&&(e.docs.forEach((function(e){return t.saleProducts.push(e.data())})),t.$bvModal.msgBoxConfirm("Are you sure you want to remove sale price for [".concat(t.saleProductCount,"] products?")).then((function(e){e&&t.saleProducts.forEach((function(e){e.cwSalePricePick=!1,t.$fb.productCollection.doc(e.id).set(e)}))})).catch((function(t){console.log(t)}))))}))}})},Gt=Kt,Jt=(r("b12d"),Object(l["a"])(Gt,v,b,!1,null,null,null)),Xt=Jt.exports,Zt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[r("i",{staticClass:"fa fa-book"}),t._v(" Inventory ("+t._s(t.inventoryCount)+") ")]),r("div",{staticClass:"pull-right"},[r("b-link",{staticClass:"ml-1",on:{click:t.addNewItem}},[t._v("Add New Item")])],1)]),r("b-row",[r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-input-group",{staticClass:"mb-5"},[r("b-form-input",{on:{keydown:function(e){return t.seartTextKeydown(e)}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),r("b-input-group-append",[""!=t.searchText?r("span",{staticClass:"fa fa-close",attrs:{id:"searchclear"},on:{click:t.clearSearchText}}):t._e(),r("b-button",{attrs:{variant:"outline-success"},on:{click:function(e){return t.search()}}},[r("span",{staticClass:"fa fa-search"}),t._v(" Search ")])],1)],1)],1)],1),r("b-form-group",{attrs:{label:""}},[r("b-form-checkbox",{attrs:{inline:""},on:{change:t.showOutOfStockChange},model:{value:t.filter.showOutOfStock,callback:function(e){t.$set(t.filter,"showOutOfStock",e)},expression:"filter.showOutOfStock"}},[t._v("Show Out Of Stock")])],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("b-table",{ref:"inventoryTable",attrs:{responsive:"sm",items:t.items,fields:t.fields,small:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.itemClicked,"row-dblclicked":t.itemDoubleClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(name)",fn:function(e){return[r("div",{staticClass:"prod-thumbnail-name"},[r("div",{staticClass:"thumbnail"},[e.item.product.thumbnail?r("img",{attrs:{src:e.item.product.thumbnail,width:"50px",height:"50px"}}):t._e()]),r("div",{staticClass:"name-2"},[r("b-link",{on:{click:function(r){return t.showProductDetail(e)}}},[t._v(t._s(e.item.product.name))]),r("br"),0==e.item.quantity?r("b-badge",{attrs:{variant:"danger"}},[t._v("Out of Stock")]):t._e()],1)])]}},{key:"cell(weight)",fn:function(e){return[r("strong",[t._v(t._s(e.item.product.weight)+"(g)")]),t._v(" - "+t._s(t._f("currency")(e.item.product.shipPrice,t.audConfig))+" ")]}},{key:"cell(rndPrice)",fn:function(e){return[r("span",{staticClass:"price"},[r("strong",[t._v(t._s(t._f("currency")(e.item.product.rndPrice,t.vndConfig)))])]),r("br"),r("small",[t._v("Sug. Price: "+t._s(t._f("currency")(e.item.product.sugPrice,t.audConfig))+" - "+t._s(t._f("currency")(16500*e.item.product.sugPrice,t.vndConfig)))])]}},{key:"cell(dateIn)",fn:function(e){return[t._v(t._s(t._f("date")(e.item.dateIn.toDate())))]}},{key:"cell(quantity)",fn:function(e){return[r("number-input",{attrs:{min:0,max:9999,inline:"",controls:"",center:"",size:"sm"},on:{change:function(r){return t.quantityChange(e.item,r)}},model:{value:e.item.quantity,callback:function(r){t.$set(e.item,"quantity",r)},expression:"data.item.quantity"}})]}},{key:"cell(action)",fn:function(e){return[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"info"},on:{click:function(r){return t.viewHistory(e)}}},[r("i",{staticClass:"fa fa-list"}),t._v(" History ")]),r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editItem(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteItem(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])]}}])})]},proxy:!0},{key:"mobile",fn:function(){return[r("div",[r("b-table",{ref:"inventoryTable",attrs:{responsive:"sm",items:t.items,fields:t.mobileFields,small:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.itemClicked,"row-dblclicked":t.itemDoubleClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[r("div",{staticClass:"row"},[r("div",{staticClass:"col-4",staticStyle:{overflow:"hidden"}},[r("img",{attrs:{src:e.item.product.thumbnail,width:"150px",height:"150px"}})]),r("div",{staticClass:"col-8"},[r("span",{staticClass:"h5"},[t._v(" "+t._s(e.item.product.name)+" "),0==e.item.quantity?r("b-badge",{attrs:{variant:"danger"}},[t._v("Out of Stock")]):t._e()],1),r("br"),r("strong",[t._v("Weight:")]),t._v(" "+t._s(e.item.product.weight)+"(g) - "+t._s(t._f("currency")(e.item.product.shipPrice,t.audConfig))+" "),r("br"),r("show-supplier-prices",{attrs:{product:e.item.product}}),r("span",{staticClass:"price"},[r("strong",[t._v("Price: "+t._s(t._f("currency")(e.item.product.rndPrice,t.vndConfig)))]),r("small",{staticClass:"ml-3"},[t._v("Sug. Price: "+t._s(t._f("currency")(e.item.product.sugPrice,t.audConfig))+" - "+t._s(t._f("currency")(16500*e.item.product.sugPrice,t.vndConfig)))])]),r("br"),r("strong",[t._v("Date In:")]),t._v(" "+t._s(t._f("date")(e.item.dateIn.toDate()))+" "),r("br"),r("strong",[t._v("Quantity:")]),r("number-input",{attrs:{min:0,max:9999,inline:"",controls:"",center:"",size:"sm"},on:{change:function(r){return t.quantityChange(e.item,r)}},model:{value:e.item.quantity,callback:function(r){t.$set(e.item,"quantity",r)},expression:"data.item.quantity"}}),r("div",{staticClass:"mt-2"},[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"info"},on:{click:function(r){return t.viewHistory(e)}}},[r("i",{staticClass:"fa fa-list"}),t._v(" History ")]),r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editItem(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteItem(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])],1)],1)])]}}])})],1)]},proxy:!0}])}),r("b-row",{staticClass:"load-more"},[r("b-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],attrs:{variant:"outline-success"},on:{click:function(e){return t.loadMore(e)}}},[t._v("Load more")])],1)],1)],1)],1),r("inventory-edit-item",{ref:"inventoryEditItemModal",attrs:{id:"inventoryEditItemModal"},on:{"item-saved":t.itemSaved}}),r("product-detail",{ref:"productDetail",attrs:{readonly:!0},on:{"product-saved":t.productSaved}}),r("inventory-item-history",{ref:"inventoryItemHistoryModal",attrs:{id:"inventoryItemHistoryModal"}})],1)},te=[],ee=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{attrs:{id:t.modalId,title:t.modalTitle,size:"lg"},on:{ok:t.save}},[r("b-row",[r("b-col",{attrs:{sm:"8"}},[r("b-form-group",[r("label",[t._v("Product")]),r("vue-suggestion",{attrs:{items:t.sugProducts,"item-template":t.productSugTemplate,setLabel:t.setLabel},on:{focus:t.sugProductsFocused,onInputChange:t.sugProductsInputChanged,onItemSelected:t.sugProductsItemSelected,scrollEnd:t.loadMoreSugProducts},model:{value:t.item.product,callback:function(e){t.$set(t.item,"product",e)},expression:"item.product"}})],1)],1),r("b-col",{attrs:{sm:"4"}},[r("b-form-group",[r("label",[t._v("Quantity")]),r("number-input",{attrs:{min:1,max:9999,inline:"",controls:"",center:""},model:{value:t.item.quantity,callback:function(e){t.$set(t.item,"quantity",e)},expression:"item.quantity"}})],1)],1)],1),r("b-row",[r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Note")]),r("b-form-textarea",{attrs:{placeholder:"Enter something...",rows:"5"},model:{value:t.item.note,callback:function(e){t.$set(t.item,"note",e)},expression:"item.note"}})],1)],1)],1)],1)},re=[],ne=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"vue-suggestion",class:t.wrapperClasses},[r("div",{staticClass:"vue-suggestion-input-group",class:[{"vue-suggestion-selected":t.value},t.inputWrapperClasses]},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],ref:"searchText",staticClass:"vue-suggestion-input",class:t.inputClasses,attrs:{placeholder:t.placeholder,disabled:t.disabled,type:"search"},domProps:{value:t.searchText},on:{blur:t.blur,focus:t.focus,input:[function(e){e.target.composing||(t.searchText=e.target.value)},t.inputChange],keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.keyEnter(e))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.preventDefault(),t.keyUp(e))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.preventDefault(),t.keyDown(e))}]}}),t._t("searchSlot")],2),t.loading?t._t("loading",[t._v("Loading...")]):t.showList?t._t("suggestionList",[r("div",{ref:"vueSuggestionList",staticClass:"vue-suggestion-list"},[t._l(t.items,(function(e,n){return r("div",{key:e.id,staticClass:"vue-suggestion-list-item",class:[{"vue-suggestion-item-active":n===t.cursor},t.suggestionItemWrapperClasses],on:{click:function(r){return t.selectItem(e)},mouseover:function(e){t.cursor=n}}},[r(t.itemTemplate,{tag:"div",class:t.suggestionItemClasses,attrs:{item:e}})],1)})),r("div",{staticClass:"vue-suggestion-list-item load-more-item",staticStyle:{"text-align":"center"}},[r("button",{staticClass:"btn btn-outline-success btn-sm",on:{click:t.loadMore}},[t._v("Load more")])])],2)]):t._e()],2)},ie=[],se=r("1157"),ae=r.n(se),oe={name:"VueSuggestion",props:{itemTemplate:{type:Object,required:!0},minLen:{type:Number,default:1},value:{type:[Object,String,Number],default:null},setLabel:{type:Function,default:function(t){return t}},items:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},placeholder:{type:String,default:""},inputClasses:{type:String,default:""},wrapperClasses:{type:String,default:""},inputWrapperClasses:{type:String,default:""},suggestionListClasses:{type:String,default:""},suggestionGroupClasses:{type:String,default:""},suggestionGroupHeaderClasses:{type:String,default:""},suggestionItemWrapperClasses:{type:String,default:""},suggestionItemClasses:{type:String,default:""}},data:function(){return{searchText:"",showList:!1,cursor:0}},computed:{itemGroups:function(){return this.items.reduce((function(t,e){var r=t.find((function(t){return t.header===e.suggestionGroup}));return r?r.items.push(e):t.push({header:e.suggestionGroup||"",items:[e]}),t}),[])}},watch:{value:{handler:function(t){t&&(this.searchText=this.setLabel(t))},deep:!0},"items.length":function(){this.showList=this.isAbleToShowList();var t=this;ae()(this.$refs.vueSuggestionList).on("scroll",(function(){ae()(this).scrollTop()+ae()(this).innerHeight()>=ae()(this)[0].scrollHeight&&t.$emit("scrollEnd",t.items.length)}))}},created:function(){this.checkMissingProps()},mounted:function(){this.value&&(this.searchText=this.setLabel(this.value))},methods:{inputChange:function(){var t=this;this.showList=this.isAbleToShowList(),this.cursor=0,ht&&window.clearTimeout(ht),ht=window.setTimeout((function(){t.$emit("onInputChange",t.searchText)}),500)},isAbleToShowList:function(){return!0},checkMissingProps:function(){this.itemTemplate||console.warn("You need to pass `template` as the suggestion list item template")},focus:function(){this.$emit("focus",this.searchText),this.showList=this.isAbleToShowList()},blur:function(){var t=this;this.$emit("blur",this.searchText),mt=setTimeout((function(){t.showList=!1}),200)},loadMore:function(){mt&&window.clearTimeout(mt),ae()(this.$refs.searchText).focus(),this.$emit("scrollEnd",this.items.length)},selectItem:function(t){t&&(this.searchText=this.setLabel(t),this.$emit("onItemSelected",t)),this.$emit("input",t)},keyUp:function(){this.$emit("keyUp",this.searchText),this.cursor>0&&(this.cursor-=1)},keyDown:function(){this.$emit("keyDown",this.searchText),this.cursor<this.items.length-1?this.cursor+=1:this.$emit("scrollEnd",this.items.length)},keyEnter:function(){this.showList&&this.items[this.cursor]&&(this.selectItem(this.items[this.cursor]),this.showList=!1),this.$emit("onEnter",this.items[this.cursor])}}},ce=oe,ue=(r("b96f"),Object(l["a"])(ce,ne,ie,!1,null,null,null)),le=ue.exports,de=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("b-row",[r("b-col",{staticStyle:{overflow:"hidden"},attrs:{sm:"3"}},[r("img",{attrs:{src:t.item.thumbnail,alt:t.item.name.substring(0,20),width:"50px",height:"50px"}})]),r("b-col",{attrs:{sm:"8"}},[t._v(" "+t._s(t.item.name)+" "),r("br"),r("span",{staticClass:"h5"},[t._v(t._s(t._f("currency")(t.item.rndPrice,t.vndConfig)))])])],1)],1)},pe=[],me={props:{item:{required:!0}},computed:{address:function(){return(this.item.address||"Not Provided").substring(0,100)}}},he=me,fe=Object(l["a"])(he,de,pe,!1,null,null,null),ve=fe.exports,be=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",t._g({staticClass:"input-group",class:{"input-group-sm":"sm"==t.size,"input-group-lg":"lg"==t.size}},t.listeners),[r("div",{staticClass:"input-group-prepend"},[t.controls?r("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button",disabled:t.disabled||t.readonly||!t.decreasable},on:{click:t.decrease}},[r("i",{staticClass:"fa fa-minus"})]):t._e()]),r("input",t._b({ref:"input",staticClass:"form-control",class:{"text-center":t.center},attrs:{type:"text",name:t.name,min:t.min,max:t.max,step:t.step,readonly:t.readonly||!t.inputtable,disabled:t.disabled||!t.decreasable&&!t.increasable,placeholder:t.placeholder,autocomplete:"off"},domProps:{value:t.currentValue},on:{change:t.change,paste:t.paste}},"input",t.attrs,!1)),r("div",{staticClass:"input-group-append"},[t.controls?r("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button",disabled:t.disabled||t.readonly||!t.increasable},on:{click:t.increase}},[r("i",{staticClass:"fa fa-plus"})]):t._e()])])},ge=[],ye=(r("ee1d"),Number.isNaN||window.isNaN),_e=/^-?(?:\d+|\d+\.\d+|\.\d+)(?:[eE][-+]?\d+)?$/,Ce=/\.\d*(?:0|9){10}\d*$/,ke=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Ce.test(t)?Math.round(t*e)/e:t},we={name:"NumberInput",model:{event:"change"},props:{attrs:{type:Object,default:void 0},center:Boolean,controls:Boolean,disabled:Boolean,inputtable:{type:Boolean,default:!0},inline:Boolean,max:{type:Number,default:1/0},min:{type:Number,default:-1/0},name:{type:String,default:void 0},placeholder:{type:String,default:void 0},readonly:Boolean,rounded:Boolean,size:{type:String,default:void 0},step:{type:Number,default:1},value:{type:Number,default:NaN}},data:function(){return{currentValue:NaN}},mouted:function(){},computed:{increasable:function(){var t=this.currentValue;return ye(t)||t<this.max},decreasable:function(){var t=this.currentValue;return ye(t)||t>this.min},listeners:function(){var t=Object(g["a"])({},this.$listeners);return delete t.change,t}},watch:{value:{immediate:!0,handler:function(t,e){ye(t)||e?ye(t)&&"undefined"===typeof e||t===this.currentValue||this.setValue(t):this.currentValue=t}}},methods:{change:function(t){this.setValue(Math.min(this.max,Math.max(this.min,t.target.value)))},paste:function(t){var e=t.clipboardData||window.clipboardData;e&&!_e.test(e.getData("text"))&&t.preventDefault()},decrease:function(){if(this.decreasable){var t=this.currentValue;ye(t)&&(t=0),this.setValue(Math.min(this.max,Math.max(this.min,ke(t-this.step))))}},increase:function(){if(this.increasable){var t=this.currentValue;ye(t)&&(t=0),this.setValue(Math.min(this.max,Math.max(this.min,ke(t+this.step))))}},setValue:function(t){var e=this.currentValue,r=this.rounded?Math.round(t):t;this.min<=this.max&&(r=Math.min(this.max,Math.max(this.min,r))),this.currentValue=r,r===e&&(this.$refs.input.value=r),this.$emit("change",r,e)}}},Pe=we,xe=(r("e502"),Object(l["a"])(Pe,be,ge,!1,null,"d6cfd592",null)),Se=xe.exports,Ie={name:"InventoryEditItem",props:["id"],components:{vueSuggestion:le,numberInput:Se},data:function(){return{item:{},sugProducts:[],modalTitle:"",modalId:"",productSugTemplate:ve}},mounted:function(){this.modalId=this.id||"inventoryEditItemModal"},watch:{},computed:{},methods:{open:function(t){var e=this;this.item=t?Object(g["a"])({},t):{quantity:1,note:"",product:{},dateIn:new Date},this.modalTitle=t?"Edit Order Item":"Add Order Item",this.$nextTick((function(){return e.$bvModal.show(e.modalId)}))},sugProductsFocused:function(){var t=this;0==this.sugProducts.length&&this.loadProducts().then((function(e){return e.forEach((function(e){return t.sugProducts.push(e)}))}))},sugProductsInputChanged:function(t){var e=this;this.productSugSearchText=t,this.sugProducts=[],this.lastSugProductVisible=void 0,ft&&window.clearTimeout(ft),ft=this.loadProducts(t).then((function(t){t.forEach((function(t){return e.sugProducts.push(t)}))}))},loadMoreSugProducts:function(t){var e=this;this.isLoadingMoreSugProduct||(this.isLoadingMoreSugProduct=!0,this.loadProducts(this.productSugSearchText,this.lastSugProductVisible).then((function(t){t.forEach((function(t){return e.sugProducts.push(t)})),e.isLoadingMoreSugProduct=!1})))},loadProducts:function(t,e){var r=this,n=this.$fb.productCollection.limit(5).orderBy("name");return t&&(n=n.where("nameSearch","array-contains",t.toLowerCase().trim())),e&&(n=n.startAfter(e)),n.get().then((function(t){var e=[];return t.empty||(r.lastSugProductVisible=_.last(t.docs),t.forEach((function(t){e.push(t.data())}))),e}))},sugProductsItemSelected:function(t){},setLabel:function(t){return t.name},save:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.item.id){t.next=7;break}return this.item.audit||(this.item.audit=[]),this.item.audit.push(this.$fbServices.inventoryService.buildAuditItem(this.item,"Update")),t.next=5,this.$fb.inventoryCollection.doc(this.item.id).set(this.item);case 5:t.next=16;break;case 7:return e=this.$fb.inventoryCollection.doc(),this.item.id=e.id,this.item.audit||(this.item.audit=[]),this.item.audit.push(this.$fbServices.inventoryService.buildAuditItem(this.item,"Init")),t.next=13,e.set(this.item);case 13:return t.next=15,e.get().then((function(t){return t.data()}));case 15:this.item=t.sent;case 16:this.showMessage("Item saved!"),this.$emit("item-saved",this.item),this.$bvModal.hide(this.id);case 19:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},Oe=Ie,$e=Object(l["a"])(Oe,ee,re,!1,null,null,null),Te=$e.exports,De=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{attrs:{id:t.modalId,title:t.modalTitle,size:"lg"}},[r("b-table",{ref:"inventoryTable",attrs:{responsive:"sm",items:t.audit,fields:t.fields,small:!0,selectable:"","select-mode":"single"},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(date)",fn:function(e){return[t._v(t._s(t._f("datetime")(e.value.toDate())))]}},{key:"cell(distribution)",fn:function(e){return[e.item.distributionId?r("div",[t._v(t._s("distribute: [{0}] to order: {1} - order iten: {2}".format(e.item.distribution.quantity,e.item.distribution.orderId,e.item.distribution.orderItemId)))]):t._e()]}}])})],1)},Ee=[],Me={name:"InventoryItemHistory",props:["id"],components:{},data:function(){return{item:{},audit:[],modalTitle:"",modalId:"",fields:[{key:"index",label:"#",class:"i-index"},{key:"message",label:"Event",class:"ih-event"},{key:"date",label:"Date",class:"ih-date"},{key:"product.price",label:"Price",class:"ih-price"},{key:"quantity",label:"Quantity",class:"ih-quantity"},{key:"distribution",class:"ih-distribution"}]}},mounted:function(){this.modalId=this.id||"inventoryEditItemModal"},watch:{},computed:{},methods:{open:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n,i,s,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$fbServices.inventoryService.get(e.id);case 2:this.item=t.sent,r=this.item.product,n=r.name,i=r.rndPrice,s=this.item.quantity,this.modalTitle="Inventory: {0} - Price: {1} - Qty: {2}".format(n,i,s),this.audit=_.orderBy(this.item.audit,(function(t){return t.date}),"desc"),this.audit.forEach((function(t){t.distributionId&&(t.distribution=a.item.distributions.find((function(e){return e.id=t.distributionId})))})),this.$nextTick((function(){return a.$bvModal.show(a.modalId)}));case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}},je=Me,qe=Object(l["a"])(je,De,Ee,!1,null,null,null),Re=qe.exports,Fe={name:"Inventory",components:{productDetail:$t,viewPort:R,InventoryEditItem:Te,ShowSupplierPrices:At,numberInput:Se,InventoryItemHistory:Re},data:function(){return{items:[],searchText:"",pageSize:10,lastVisible:void 0,isLoading:!1,selectedItemIndex:-1,inventoryCount:0,fields:[{key:"index",label:"#",class:"i-index"},{key:"name",class:"i-name"},{key:"weight",label:"Weight (g)",class:"i-weight"},{key:"rndPrice",label:"Price",class:"i-rnd-price"},{key:"dateIn",label:"Date In",class:"i-date-in"},{key:"quantity",label:"Quantity",class:"i-quantity"},{key:"note",label:"Note",class:"i-note"},{key:"action",label:"Action",class:"i-action"}],mobileFields:[{key:"index",label:"",class:"i-index"}],filter:{showOutOfStock:!1}}},mounted:function(){this.loadData()},watch:{searchText:function(t,e){""!=e&&""==t&&(this.products=[],this.loadProducts())}},computed:{},methods:{loadData:function(){var t=this;this.isLoading=!0;var e=this.$fb.inventoryCollection;this.filter.showOutOfStock||(e=e.where("quantity",">",0)),e=e.orderBy("quantity","desc").orderBy("product.name").orderBy("dateIn").limit(20),this.lastVisible&&(e=e.startAfter(this.lastVisible)),e=e.get().then((function(e){return t.isLoading=!1,e.empty?[]:(t.lastVisible=_.last(e.docs),e.docs.map((function(t){return t.data()})))})).then((function(e){e.forEach((function(e){return t.items.push(e)}))}))},addNewItem:function(){this.$refs.inventoryEditItemModal.open()},loadMore:function(){this.loadData()},search:function(){},seartTextKeydown:function(){},clearSearchText:function(){},itemClicked:function(){},itemDoubleClicked:function(t,e){this.selectedItemIndex=e,this.$refs.inventoryEditItemModal.open(t)},quantityChange:function(t,e){t.id&&(t.quantity=e,this.saveItem(t))},saveItem:function(t){var e=this;vt&&window.clearTimeout(vt),vt=window.setTimeout((function(){t.id&&e.$fbServices.inventoryService.set(t).then((function(){return e.showMessage("Inventory item saved!")}))}),500)},editItem:function(t){this.selectedItemIndex=t.index,this.$refs.inventoryEditItemModal.open(t.item)},deleteItem:function(t){var e=this;this.$bvModal.msgBoxConfirm("Are you sure you want to delete this item?").then((function(r){r&&e.$fb.inventoryCollection.doc(t.item.id).delete().then((function(){var r=e.items.findIndex((function(e){return e.id==t.item.id}));r>-1&&e.items.splice(r,1)}))})).catch((function(t){console.log(t)}))},itemSaved:function(t){this.selectedItemIndex>-1?(this.items.splice(this.selectedItemIndex,1,t),this.selectedItemIndex=-1):this.items.push(t)},showProductDetail:function(t){var e=t.index,r=t.item;this.selectedItemIndex=e,this.$refs.productDetail.open(r.product)},productSaved:function(t){if(this.selectedItemIndex>-1){var e=this.items[this.selectedItemIndex];e.product=t,this.items.splice(this.selectedItemIndex,1,e),this.saveItem(e),this.selectedItemIndex=-1}},viewHistory:function(t){this.$refs.inventoryItemHistoryModal.open(t.item)},showOutOfStockChange:function(t){var e=this;this.lastVisible=void 0,this.items=[],this.$nextTick((function(){return e.loadData()}))}}},Ae=Fe,Le=(r("01e5"),Object(l["a"])(Ae,Zt,te,!1,null,null,null)),Be=Le.exports,Ne=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[r("i",{staticClass:"fa fa-user-o"}),t._v(" Customers ("+t._s(t.count)+") ")]),r("div",{staticClass:"pull-right"},[r("b-link",{on:{click:t.calculateTotalBuying}},[t._v("Calculate Total Buying | ")]),r("b-link",{on:{click:t.addNewCustomer}},[t._v("Add New Customer")])],1)]),r("b-row",[r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-input-group",{staticClass:"mb-5"},[r("b-form-input",{on:{keydown:function(e){return t.seartTextKeydown(e)}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),r("b-input-group-append",[""!=t.searchText?r("span",{staticClass:"fa fa-close",attrs:{id:"searchclear"},on:{click:t.clearSearchText}}):t._e(),r("b-button",{attrs:{variant:"outline-success"},on:{click:function(e){return t.clickSearchCustomer()}}},[r("span",{staticClass:"fa fa-search"}),t._v(" Search ")])],1)],1),r("b-form-group",[r("b-form-checkbox",{attrs:{inline:""},on:{change:t.showOnlyDebtChange},model:{value:t.filter.showOnlyDebt,callback:function(e){t.$set(t.filter,"showOnlyDebt",e)},expression:"filter.showOnlyDebt"}},[t._v("Show Only Debt")])],1)],1)],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("b-table",{ref:"customerTable",attrs:{responsive:"sm",items:t.customers,fields:t.fields,small:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.customerClicked,"row-dblclicked":t.customerDoubleClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(name)",fn:function(e){return[e.item.isEditing?[r("b-form-input",{attrs:{type:"text",placeholder:"Enter customer name"},model:{value:e.item.name,callback:function(r){t.$set(e.item,"name",r)},expression:"data.item.name"}})]:t._e(),e.item.isEditing?t._e():[r("text-highlight",{attrs:{queries:t.queries}},[t._v(t._s(e.value))])]]}},{key:"cell(address)",fn:function(e){return[e.item.isEditing?[r("b-form-input",{attrs:{type:"text",placeholder:"Enter customer address"},model:{value:e.item.address,callback:function(r){t.$set(e.item,"address",r)},expression:"data.item.address"}})]:t._e(),e.item.isEditing?t._e():[t._v(t._s(e.value))]]}},{key:"cell(phone)",fn:function(e){return[e.item.isEditing?[r("b-form-input",{attrs:{type:"text",placeholder:"Enter customer phone"},model:{value:e.item.phone,callback:function(r){t.$set(e.item,"phone",r)},expression:"data.item.phone"}})]:t._e(),e.item.isEditing?t._e():[t._v(t._s(e.value))]]}},{key:"cell(statistic.totalBuying)",fn:function(e){return[t._v(t._s(t._f("currency")(e.value,t.vndConfig)))]}},{key:"cell(statistic.purchased)",fn:function(e){return[t._v(t._s(t._f("currency")(e.value,t.vndConfig)))]}},{key:"cell(statistic.debt)",fn:function(e){return[t._v(t._s(t._f("currency")(e.value,t.vndConfig)))]}},{key:"cell(action)",fn:function(e){return[e.item.isEditing?t._e():[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"info"},on:{click:function(r){return t.viewOrders(e)}}},[r("i",{staticClass:"fa fa-list"}),t._v(" Orders ")]),r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editCustomer(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteCustomer(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])],e.item.isEditing?[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.saveCustomer(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Save ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.cancelEditCustomer(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Cancel ")])]:t._e()]}}])})]},proxy:!0},{key:"mobile",fn:function(){return[r("div",[r("b-table",{ref:"customerTable",attrs:{responsive:"sm",items:t.customers,fields:t.mobileFields,small:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.customerClicked,"row-dblclicked":t.customerDoubleClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(name)",fn:function(e){return[r("b-row",[r("b-col",[e.item.isEditing?[r("b-form-group",{attrs:{"label-size":"sm",label:"Name"}},[r("b-form-input",{attrs:{size:"sm",type:"text",placeholder:"Enter customer name"},model:{value:e.item.name,callback:function(r){t.$set(e.item,"name",r)},expression:"data.item.name"}})],1)]:t._e(),e.item.isEditing?t._e():[r("strong",[r("text-highlight",{attrs:{queries:t.queries}},[t._v(t._s(e.value))])],1)]],2)],1),r("b-row",[r("b-col",[e.item.isEditing?[r("b-form-group",{attrs:{"label-size":"sm",label:"Address"}},[r("b-form-input",{attrs:{size:"sm",type:"text",placeholder:"Enter customer address"},model:{value:e.item.address,callback:function(r){t.$set(e.item,"address",r)},expression:"data.item.address"}})],1)]:t._e(),e.item.isEditing?t._e():[t._v("Address: "+t._s(e.item.address))]],2)],1),r("b-row",[r("b-col",[e.item.isEditing?[r("b-form-group",{attrs:{"label-size":"sm",label:"Phone"}},[r("b-form-input",{attrs:{size:"sm",type:"text",placeholder:"Enter customer phone"},model:{value:e.item.phone,callback:function(r){t.$set(e.item,"phone",r)},expression:"data.item.phone"}})],1)]:t._e(),e.item.isEditing?t._e():[t._v("Phone: "+t._s(e.item.phone))]],2)],1),r("b-row",{staticClass:"mt-2 mb-2"},[r("b-col",[e.item.isEditing?t._e():[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"info"},on:{click:function(r){return t.viewOrders(e)}}},[r("i",{staticClass:"fa fa-list"}),t._v(" Orders ")]),r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editCustomer(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteCustomer(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])],e.item.isEditing?[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.saveCustomer(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Save ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.cancelEditCustomer(e)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Cancel ")])]:t._e()],2)],1)]}}])})],1)]},proxy:!0}])}),r("b-row",{staticClass:"load-more"},[r("b-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],attrs:{variant:"outline-success"},on:{click:t.loadMore}},[t._v("Load more")])],1)],1)],1)],1)],1)},Ve=[],Qe=(r("551c"),r("cadf"),r("5df3"),{name:"Customers",components:{viewPort:R,TextHighlight:Et["a"]},data:function(){return{customers:[],customer:{},searchText:"",fields:[{key:"index",label:"#",class:"customer-index-col"},{key:"name",class:"customer-name-col"},{key:"address",class:"customer-address-col"},{key:"phone",class:"customer-phone-col"},{key:"statistic.totalBuying",label:"Total Buying",class:"customer-phone-col"},{key:"statistic.purchased",label:"Purchased",class:"customer-phone-col"},{key:"statistic.debt",label:"Debt",class:"customer-phone-col"},{key:"action",class:"customer-action-col"}],mobileFields:[{key:"index",label:"#"},{key:"name",label:"Details"}],paging:{total:0,page:1,size:10},lastVisible:void 0,filter:{showOnlyDebt:!1},isLoading:!0}},mounted:function(){this.loadCustomers()},watch:{searchText:function(t,e){""!=e&&""==t&&(this.customers=[],this.lastVisible=void 0,this.loadCustomers())}},computed:Object(g["a"])({queries:function(){return this.searchText.split(" ").filter((function(t){return""!=t}))}},Object(xt["c"])("counter",{count:function(t){return t.counter&&t.counter.customerCount}})),methods:Object(g["a"])({},Object(xt["b"])("counter",["increaseCustomerCount","decreaseCustomerCount"]),{},Object(xt["b"])("order",["getAllOrders"]),{loadCustomers:function(){var t=this;this.isLoading=!0;var e=this.$fb.customerCollection.limit(this.paging.size);return e=this.filter&&this.filter.showOnlyDebt?e.where("statistic.debt",">",0).orderBy("statistic.debt","desc"):e.orderBy("name"),this.lastVisible&&(e=e.startAfter(this.lastVisible)),e.get().then((function(e){t.isLoading=!1,e.empty||(t.lastVisible=e.docs[e.docs.length-1],e.forEach((function(e){var r=e.data();r.id=e.id,t.customers.push(r)})))}))},customerClicked:function(t){this.customer=Object(g["a"])({},t)},correctData:function(){},deleteCustomer:function(t){var e=this,r=t.item,n=t.index;this.$bvModal.msgBoxConfirm("Are you sure you want to delete customer: [".concat(r.name,"]?")).then((function(t){t&&e.$fb.customerCollection.doc(r.id).delete().then((function(){e.customers.splice(n,1),e.decreaseCustomerCount()}))})).catch((function(t){console.log(t)}))},loadMore:function(){var t=this;this.isLoading=!0,this.queries.length>0?this.searchCustomer(this.lastVisible).then((function(){return t.isLoading=!1})):this.loadCustomers().then((function(){return t.isLoading=!1}))},seartTextKeydown:function(t){13===t.keyCode&&(this.customers=[],this.searchCustomer())},clickSearchCustomer:function(){this.customers=[],this.searchCustomer()},clearSearchText:function(){this.searchText=""},searchCustomer:function(t){var e=this;if(this.searchText){var r=this.$fb.customerCollection.where("nameSearch","array-contains-any",this.queries).orderBy("name");return t&&(r=r.startAfter(t)),r.limit(20).get().then((function(t){t.empty||(e.lastVisible=_.last(t.docs),t.forEach((function(t){var r=t.data();r.id=t.id,e.customers.push(r)})))}))}},editCustomer:function(t){var e=t.item,r=t.index;e.backup=Object(g["a"])({},e),e.isEditing=!0,this.customers.splice(r,1,e)},saveCustomer:function(t){var e=this,r=t.item,n=t.index;if(r.name)return delete r.backup,delete r.isEditing,this.submitCustomer(r).then((function(t){e.customers.splice(n,1,t)}))},submitCustomer:function(t){var e=this;if(t.nameSearch=O(t.name),t.version=(t.version||0)+1,t.id)return this.$fb.customerCollection.doc(t.id).set(t).then((function(){return t}));var r=this.$fb.customerCollection.doc();return t.id=r.id,r.set(t).then((function(){return e.increaseCustomerCount(),t}))},cancelEditCustomer:function(t){var e=t.item,r=t.index;e.id?this.customers.splice(r,1,e.backup):this.customers.splice(r,1)},addNewCustomer:function(){var t={name:"",address:"",phone:"",isEditing:!0};this.customers.unshift(t)},customerDoubleClicked:function(t,e,r){this.editCustomer({index:e,item:t})},viewOrders:function(t){t.index;var e=t.item;this.$router.push({name:"CustomerOrders",params:{id:e.id}})},calculateTotalBuying:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.$bvModal.msgBoxConfirm("Are you sure you want to calculate total buying?").then(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(r){var i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=10;break}return t.next=3,e.loadOrders();case 3:return i=t.sent,t.next=6,e.loadAllCustomers();case 6:return s=t.sent,t.next=9,Promise.all(s.map(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.calculateTotalBuyingForCustomer(r,i),r.statistic=n,console.log(r),t.next=5,e.$fb.customerCollection.doc(r.id).set(r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 9:e.$bvModal.msgBoxConfirm("Calculate successfully, Click Ok to refresh page!").then((function(t){t&&(e.customers=[],e.lastVisible=void 0,e.loadCustomers())}));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.log(t)}));case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),calculateTotalBuyingForCustomer:function(t,e){var r=e.filter((function(e){return e.items&&e.items.length>0&&void 0!=e.items.find((function(e){return e.customer&&e.customer.id==t.id}))})).reduce((function(t,e){return t.concat(e.items)}),[]).filter((function(e){return e.customer&&e.customer.id==t.id}));return{totalBuying:_.sumBy(r,(function(t){return parseFloat(t.rndPrice)*parseFloat(t.quantity)})),purchased:_.sumBy(r.filter((function(t){return t.purchased})),(function(t){return parseFloat(t.rndPrice)*parseFloat(t.quantity)})),debt:_.sumBy(r.filter((function(t){return!t.purchased})),(function(t){return parseFloat(t.rndPrice)*parseFloat(t.quantity)}))}},loadOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getAllOrders();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),loadAllCustomers:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.$fb.customerCollection.get().then((function(t){return t.empty?[]:t.docs.map((function(t){return t.data()}))})));case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showOnlyDebtChange:function(t){var e=this;this.customers=[],this.lastVisible=void 0,this.$nextTick((function(){e.loadCustomers()}))}})}),ze=Qe,We=Object(l["a"])(ze,Ne,Ve,!1,null,null,null),He=We.exports,Ue=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("b-link",{on:{click:t.goToCustomers}},[r("i",{staticClass:"fa fa-user-o"}),t._v(" Customers: ")]),r("strong",[t._v(t._s(t.customer.name))]),t._v("'s Orders ")],1),r("b-row",[r("b-col",{attrs:{cols:"6",lg:"1"}},[t._v("Total Buying")]),r("b-col",{staticClass:"text-right",attrs:{cols:"6",lg:"2"}},[r("strong",[t._v(t._s(t._f("currency")(t.totalBuying,t.vndConfig)))])])],1),r("b-row",[r("b-col",{attrs:{cols:"6",lg:"1"}},[t._v("Purchased")]),r("b-col",{staticClass:"text-right",attrs:{cols:"6",lg:"2"}},[r("strong",[t._v(t._s(t._f("currency")(t.purchased,t.vndConfig)))])])],1),r("b-row",{staticStyle:{"margin-bottom":"20px"}},[r("b-col",{attrs:{cols:"6",lg:"1"}},[t._v("Debt")]),r("b-col",{staticClass:"text-right",attrs:{cols:"6",lg:"2"}},[r("strong",[t._v(t._s(t._f("currency")(t.debt,t.vndConfig)))])])],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("div",[r("b-table",{attrs:{responsive:"sm",items:t.customerOrders,fields:t.fields,small:!0,hover:!0},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(name)",fn:function(e){return[r("a",{staticStyle:{"font-size":"15px"},attrs:{href:t.buildRoute(e.item),variant:"link"}},[t._v(t._s(e.item.name))])]}},{key:"cell(products)",fn:function(e){return[r("table",{staticClass:"table table-borderless product-table"},t._l(e.item.items,(function(e,n){return r("tr",{key:n},[r("td",[t._v(t._s(e.product.name))]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}},[t._v(t._s(e.quantity))]),r("td",{staticClass:"text-right",staticStyle:{width:"25%"}},[t._v(t._s(t._f("currency")(e.rndPrice,t.vndConfig)))])])})),0)]}},{key:"cell(totalQuantity)",fn:function(e){return[r("strong",[t._v(t._s(e.value))])]}},{key:"cell(totalPrice)",fn:function(e){return[r("strong",[t._v(t._s(t._f("currency")(e.value,t.vndConfig)))])]}},{key:"cell(purchased)",fn:function(e){return[r("b-form-checkbox",{model:{value:e.item.purchased,callback:function(r){t.$set(e.item,"purchased",r)},expression:"data.item.purchased"}})]}}])})],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("b-table",{attrs:{responsive:"sm",items:t.customerOrders,fields:t.mobileFields,small:!0,hover:!0},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[r("b-row",[r("b-col",[r("strong",[t._v(" "+t._s(e.index+1)+". "),r("a",{staticStyle:{"font-size":"15px"},attrs:{href:t.buildRoute(e.item),variant:"link"}},[t._v(t._s(e.item.name))])])]),r("b-col",{staticClass:"text-right"},[r("b-form-checkbox",{attrs:{disabled:!0},model:{value:e.item.purchased,callback:function(r){t.$set(e.item,"purchased",r)},expression:"data.item.purchased"}},[t._v("Purchased")])],1)],1),r("b-row",[r("b-col",[r("table",{staticClass:"table table-borderless product-table"},[t._l(e.item.items,(function(e,n){return r("tr",{key:n},[r("td",[t._v(t._s(e.product.name))]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}},[t._v(t._s(e.quantity))]),r("td",{staticClass:"text-right",staticStyle:{width:"27%"}},[t._v(t._s(t._f("currency")(e.rndPrice,t.vndConfig)))])])})),r("tr",[r("td",[t._v("Total")]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}},[r("strong",[t._v(t._s(e.item.totalQuantity))])]),r("td",{staticClass:"text-right",staticStyle:{width:"27%"}},[r("strong",[t._v(t._s(t._f("currency")(e.item.totalPrice,t.vndConfig)))])])])],2)])],1)]}}])})]},proxy:!0}])})],1)],1)],1)],1)},Ye=[],Ke={name:"Orders",components:{viewPort:R},data:function(){return{customer:{},customerOrders:[],fields:[{key:"index",label:"#",class:"shipment-index-col"},{key:"name",label:"Order name"},{key:"products",label:"Products",class:"customer-order-product-col"},{key:"totalQuantity",label:"Total Qty",class:"text-center shipment-quantity-col",tdClass:"vertical-middle"},{key:"totalPrice",label:"Total Price",class:"text-right shipment-price-col"},{key:"purchased",label:"Purchased",class:"text-center shipment-purchased-col"}],mobileFields:[{key:"index"}]}},mounted:function(){this.loadCustomer()},computed:{debt:function(){return this.customerOrders?_.chain(this.customerOrders).filter((function(t){return 0==t.purchased})).sumBy((function(t){return t.totalPrice})).value():0},totalBuying:function(){return this.customerOrders?_.chain(this.customerOrders).sumBy((function(t){return t.totalPrice})).value():0},purchased:function(){return this.customerOrders?_.chain(this.customerOrders).filter((function(t){return 1==t.purchased})).sumBy((function(t){return t.totalPrice})).value():0}},methods:{loadCustomer:function(){var t=this,e=this.$route.params.id;this.$fb.customerCollection.doc(e).get().then((function(e){return t.customer=e.data()})).then(this.loadCustomerOrders)},loadCustomerOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadOrders();case 2:return e=t.sent,t.next=5,this.buildCustomerOrders(e);case 5:this.customerOrders=t.sent,console.log(this.customerOrders);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),goToCustomers:function(){this.$router.push({name:"Customers"})},recalculateOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadOrders();case 2:return e=t.sent,t.next=5,this.buildCustomerOrders(e);case 5:this.customerOrders=t.sent,console.log(this.customerOrders);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),buildCustomerOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.filter((function(t){return t.items&&t.items.length>0&&void 0!=t.items.find((function(t){return t.customer&&t.customer.id==n.customer.id}))})),r.forEach((function(t){t.items=t.items.filter((function(t){return t.customer&&t.customer.id==n.customer.id})),t.totalQuantity=_.sumBy(t.items,(function(t){return t.quantity})),t.totalPrice=_.sumBy(t.items,(function(t){return parseFloat(t.rndPrice)*parseFloat(t.quantity)})),t.purchased=void 0==_.find(t.items,(function(t){return!t.purchased}))})),t.abrupt("return",_.orderBy(r,"dateCreated","desc"));case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),loadOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("order/getAllOrders");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),buildRoute:function(t){var e=location;e.origin;return this.$router.resolve({name:"OrderDetail",params:{id:t.id}}).href}}},Ge=Ke,Je=(r("9f77"),Object(l["a"])(Ge,Ue,Ye,!1,null,"02f06ce2",null)),Xe=Je.exports,Ze=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("i",{staticClass:"cui-user icons font-lg"}),t._v(" Orders ("+t._s(t.orderCount)+") "),r("b-link",{staticClass:"pull-right",on:{click:t.addNewOrder}},[t._v("Add New Order")])],1),r("b-table",{attrs:{responsive:"sm",items:t.orders,fields:t.fields,small:!0,selectable:"","select-mode":"single",busy:t.isLoadingData},on:{"row-clicked":t.orderClicked},scopedSlots:t._u([{key:"cell(name)",fn:function(e){return[r("a",{staticStyle:{"font-size":"15px"},attrs:{href:t.buildRoute(e.item),variant:"link"}},[t._v(t._s(e.item.name))])]}},{key:"cell(dateCreated)",fn:function(e){return[t._v(t._s(t._f("date")(e.item.dateCreated.toDate())))]}},{key:"cell(quantity)",fn:function(e){return[t._v(t._s(t.sumQuantity(e.item)))]}},{key:"cell(total)",fn:function(e){return[t._v(t._s(t._f("currency")(t.sumTotal(e.item),t.vndConfig)))]}},{key:"cell(action)",fn:function(e){return[0==t.sumQuantity(e.item)?r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteOrder(e.item)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")]):t._e()]}}])}),r("b-row",{staticClass:"load-more"},[r("b-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingData,expression:"isLoadingData"}],attrs:{variant:"outline-success"},on:{click:function(e){return t.loadMore(e)}}},[t._v("Load more")])],1)],1)],1)],1),r("router-view")],1)},tr=[],er=(r("aef6"),{name:"Orders",components:{},data:function(){return{orders:[],selectedOrder:{},isLoadingData:!1,lastVisible:void 0,fields:[{key:"name"},{key:"dateCreated",label:"Created Date"},{key:"quantity",label:"Quantity"},{key:"total",label:"Total"},{key:"action",class:"text-right"}]}},mounted:function(){this.loadOrders()},computed:Object(g["a"])({},Object(xt["c"])("counter",{orderCount:function(t){return t.counter&&t.counter.orderCount}})),methods:Object(g["a"])({},Object(xt["b"])("counter",["increaseOrderCount","decreaseOrderCount"]),{},Object(xt["b"])("order",["getAllOrders","addOrUpdateOrder"]),{loadOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isLoadingData=!0,t.t0=_,t.next=4,this.getAllOrders();case 4:t.t1=t.sent,t.t2=["dateCreated"],t.t3=["desc"],this.orders=t.t0.orderBy.call(t.t0,t.t1,t.t2,t.t3),this.isLoadingData=!1;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addNewOrder:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={name:this.buildOrderName(),dateCreated:new Date,status:"OPEN"},t.next=3,this.addOrUpdateOrder(e);case 3:return e=t.sent,t.next=6,this.increaseOrderCount();case 6:this.loadOrders();case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),buildOrderName:function(){var t=(this.orderCount||0)+1;return(t+"").endsWith("1")?t+"st Order":(t+"").endsWith("2")?t+"nd Order":(t+"").endsWith("3")?t+"rd Order":t+"th Order"},orderClicked:function(t){this.selectedOrder=t,this.$router.push({name:"OrderStatistic",params:{id:t.id}})},deleteOrder:function(t){var e=this,r=this;this.$fb.orderCollection.doc(t.id).delete().then((function(){var n=r.orders.findIndex((function(e){return e.id==t.id}));n>-1&&r.orders.splice(n,1),e.decreaseOrderCount()}))},sumQuantity:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity}),0):0},sumTotal:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity*parseFloat(e.rndPrice||e.product.rndPrice)}),0):0},buildRoute:function(t){var e=location;e.origin;return this.$router.resolve({name:"OrderDetail",params:{id:t.id}}).href},loadMore:function(t){this.loadOrders()}})}),rr=er,nr=Object(l["a"])(rr,Ze,tr,!1,null,null,null),ir=nr.exports,sr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("b-link",{on:{click:t.goToOrderList}},[r("i",{staticClass:"fa fa-server"}),t._v(" Order: ")]),r("strong",[t._v(t._s(t.order.name))]),r("div",{staticClass:"pull-right"},[r("json-excel",{attrs:{data:t.jsonData,fields:t.jsonFields,worksheet:"My Worksheet",name:"filename.xls"}},[r("b-link",[t._v("Print Delivery Sheet")])],1),r("b-link",{staticClass:"mr-1 ml-1"},[t._v("|")]),r("b-link",{staticClass:"mr-1",on:{click:t.goToShipmentPage}},[t._v("Shipment Page |")]),r("b-link",{staticClass:"mr-1",on:{click:t.goToCollectionPage}},[t._v("Collection Page |")]),r("b-link",{on:{click:t.addNewOrderItem}},[t._v("Add New Item")])],1)],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("div",{staticClass:"order-item"},[r("b-table",{attrs:{"foot-clone":"",responsive:"sm",items:t.order.items,fields:t.fields,small:!0,hover:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.orderItemClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(product.name)",fn:function(e){return[r("a",{attrs:{href:"javascript:void(0)"},on:{click:function(r){return t.showProductDetailModal(e.item)}}},[t._v(t._s(e.value))]),e.item.product.cwProductId?r("b-link",{attrs:{href:t.appSettings.cwBuyProductUrl.replace("{id}",e.item.product.cwProductId),target:"_blank"}},[t._v("[Buy CW]")]):t._e(),e.item.distribution?r("span",{staticClass:"ml-2"},[r("i",[t._v("From Stock")])]):t._e(),r("br"),r("show-supplier-prices",{attrs:{product:e.item.product}})]}},{key:"cell(price)",fn:function(e){return[e.item.rndPrice!=e.item.product.rndPrice?r("del",{staticStyle:{color:"darkgrey"}},[t._v(t._s(t._f("currency")(e.item.product.rndPrice,t.vndConfig)))]):t._e(),t._v(" "+t._s(t._f("currency")(e.item.rndPrice,t.vndConfig))+" ")]}},{key:"cell(total)",fn:function(e){return[t._v(t._s(t._f("currency")(t.calculateTotalOrderItem(e.item),t.vndConfig)))]}},{key:"cell(collectedQuantity)",fn:function(e){return[r("number-input",{attrs:{min:0,max:e.item.quantity,inline:"",controls:"",center:"",size:"sm",disabled:!!e.item.distribution},on:{change:function(r){return t.collectedQuantityChanged(e.item,r)}},model:{value:e.item.collectedQuantity,callback:function(r){t.$set(e.item,"collectedQuantity",r)},expression:"data.item.collectedQuantity"}})]}},{key:"cell(collected)",fn:function(e){return[r("b-form-checkbox",{attrs:{disabled:!!e.item.distribution},on:{change:function(r){return t.collectedChanged(r,e.item)}},model:{value:e.item.collected,callback:function(r){t.$set(e.item,"collected",r)},expression:"data.item.collected"}})]}},{key:"cell(action)",fn:function(e){return[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editOrderItem(e.item)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteOrderItem(e.item)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])]}},{key:"foot()",fn:function(t){}},{key:"foot(quantity)",fn:function(e){return[t._v(t._s(t.sumQuantity))]}},{key:"foot(total)",fn:function(e){return[t._v(t._s(t._f("currency")(t.sumTotal,t.vndConfig)))]}},{key:"foot(collectedQuantity)",fn:function(e){return[t._v(t._s(t.sumCollectedQuantity))]}}])})],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("b-table",{attrs:{"foot-clone":"",responsive:"sm",items:t.order.items,fields:t.mobileFields,small:!0,selectable:"","select-mode":"single"},on:{"row-clicked":t.orderItemClicked},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[r("div",[r("strong",[t._v(" "+t._s(e.index+1)+". "+t._s(e.item.customer.name)+" ")])]),r("div",[r("a",{attrs:{href:"javascript:void(0)"},on:{click:function(r){return t.showProductDetailModal(e.item)}}},[t._v(" "+t._s(e.item.product.name)+" "),e.item.product.buyPrice&&0!=e.item.product.buyPrice?t._e():r("small",[r("i",{staticStyle:{color:"red"}},[t._v("missing buy price")])])]),e.item.product.bvSalePricePick?r("b-badge",{attrs:{variant:"success"}},[t._v("BV Sale")]):t._e(),e.item.product.cwSalePricePick?r("b-badge",{attrs:{variant:"success"}},[t._v("CW Sale")]):t._e(),t._v(" "),e.item.product.cwProductId?r("b-link",{attrs:{href:t.appSettings.cwBuyProductUrl.replace("{id}",e.item.product.cwProductId),target:"_blank"}},[t._v("[Buy CW]")]):t._e()],1),r("div",{staticClass:"row"},[r("div",{staticClass:"col-6"},[r("small",[e.item.rndPrice!=e.item.product.rndPrice?r("del",{staticStyle:{color:"darkgrey"}},[t._v(t._s(t._f("currency")(e.item.product.rndPrice,t.vndConfig)))]):t._e()]),t._v(" "+t._s(t._f("currency")(e.item.rndPrice,t.vndConfig))+" ")]),r("div",{staticClass:"col-2"},[t._v(t._s(e.item.quantity))]),r("div",{staticClass:"col-4"},[t._v(t._s(t._f("currency")(t.calculateTotalOrderItem(e.item),t.vndConfig)))])]),r("div",{staticClass:"row",staticStyle:{"margin-top":"10px"}},[r("div",{staticClass:"col-6"},[r("div",{staticClass:"order-detail-mobile-collected-qty"},[r("number-input",{attrs:{min:0,max:e.item.quantity,inline:"",controls:"",center:"",size:"sm"},on:{change:function(r){return t.collectedQuantityChanged(e.item,r)}},model:{value:e.item.collectedQuantity,callback:function(r){t.$set(e.item,"collectedQuantity",r)},expression:"data.item.collectedQuantity"}})],1),r("div",{staticClass:"order-detail-mobile-collected-all"},[r("b-form-checkbox",{on:{change:function(r){return t.collectedChanged(r,e.item)}},model:{value:e.item.collected,callback:function(r){t.$set(e.item,"collected",r)},expression:"data.item.collected"}})],1)]),r("div",{staticClass:"col-6 pull-right"},[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editOrderItem(e.item)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteOrderItem(e.item)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])],1)])]}},{key:"foot()",fn:function(e){return[r("hr"),r("b-row",[r("b-col",[t._v("Quantity")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t.sumQuantity))])],1),r("b-row",[r("b-col",[t._v("Total")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.sumTotal,t.vndConfig)))])],1),r("b-row",[r("b-col",[t._v("Collected Qty")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t.sumCollectedQuantity))])],1)]}}])})]},proxy:!0}])})],1)],1)],1),r("product-detail",{ref:"productDetail",on:{"product-saved":t.productSaved}}),r("order-detail-edit-item",{ref:"editItemModal",attrs:{id:"editItem",item:t.selectedOrderItem},on:{"save-order-item":t.saveOrderItem}})],1)},ar=[],or=r("2ef0"),cr=r.n(or),ur=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{attrs:{id:t.modalId,title:t.modalTitle,size:"lg"},on:{ok:t.saveOrderItem}},[r("b-row",[r("b-col",{attrs:{sm:"4"}},[r("b-form-group",[r("label",[t._v("Customer")]),r("vue-suggestion",{attrs:{items:t.sugCustomers,"item-template":t.customerSugTemplate,setLabel:t.setLabel},on:{focus:t.sugCustomersFocused,onInputChange:t.sugCustomersInputChanged,scrollEnd:t.loadMoreSugCustomers},model:{value:t.orderItem.customer,callback:function(e){t.$set(t.orderItem,"customer",e)},expression:"orderItem.customer"}})],1)],1),r("b-col",{attrs:{sm:"8"}},[r("b-form-group",[r("label",[t._v("Product")]),r("vue-suggestion",{attrs:{items:t.sugProducts,"item-template":t.productSugTemplate,setLabel:t.setLabel},on:{focus:t.sugProductsFocused,onInputChange:t.sugProductsInputChanged,onItemSelected:t.sugProductsItemSelected,scrollEnd:t.loadMoreSugProducts},model:{value:t.orderItem.product,callback:function(e){t.$set(t.orderItem,"product",e)},expression:"orderItem.product"}})],1)],1)],1),t.inventoryItems.length>0?r("b-row",[r("b-col",[r("b-form-group",{attrs:{label:"Inventory (just showing, not be used at this time)"}},t._l(t.inventoryItems,(function(e,n){return r("b-form-checkbox",{key:n,attrs:{name:"some-radios",value:e,disabled:0==e.quantity},on:{change:function(r){return t.selectedInventoryItemChanged(r,e)}},model:{value:t.selectedInventoryItem,callback:function(e){t.selectedInventoryItem=e},expression:"selectedInventoryItem"}},[t._v(t._s(e.product.name)+" - Price: "+t._s(t._f("currency")(e.product.rndPrice,t.vndConfig))+" - Qty: "+t._s(e.quantity))])})),1)],1)],1):t._e(),r("b-row",[r("b-col",{attrs:{sm:"4"}},[r("b-form-group",[r("label",[t._v("Quantity")]),r("number-input",{attrs:{min:1,max:t.selectedInventoryItem?t.selectedInventoryItem.quantity:999,inline:"",controls:"",center:""},model:{value:t.orderItem.quantity,callback:function(e){t.$set(t.orderItem,"quantity",e)},expression:"orderItem.quantity"}})],1)],1),r("b-col",{attrs:{sm:"8"}},[r("b-form-group",[r("label",[t._v("Price - "+t._s(t._f("currency")(t.orderItem.rndPrice,t.vndConfig)))]),r("b-form-input",{attrs:{type:"text",placeholder:"Enter rnd price"},model:{value:t.orderItem.rndPrice,callback:function(e){t.$set(t.orderItem,"rndPrice",e)},expression:"orderItem.rndPrice"}})],1)],1)],1)],1)},lr=[],dr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",[t._v(t._s(t.item.name)+" - "+t._s(t.item.phone||"Not Provided"))]),r("span",[t._v(t._s(t.address))])])},pr=[],mr={props:{item:{required:!0}},computed:{address:function(){return(this.item.address||"Not Provided").substring(0,100)}}},hr=mr,fr=Object(l["a"])(hr,dr,pr,!1,null,null,null),vr=fr.exports,br={name:"OrderDetailEdit",props:["id"],components:{vueSuggestion:le,numberInput:Se},data:function(){return{orderItem:{},sugCustomers:[],sugProducts:[],modalTitle:"",modalId:"",customerSugTemplate:vr,productSugTemplate:ve,inventoryItems:[],selectedInventoryItem:void 0}},mounted:function(){this.modalId=this.id||"editItemModal"},watch:{selectedInventoryItem:function(t){return console.log(t)}},computed:{},methods:{open:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.orderItem=Object(g["a"])({},e),this.modalTitle=this.orderItem&&this.orderItem.customer.name?"Edit Order Item":"Add Order Item",this.inventoryItems=[],this.selectedInventoryItem=void 0,!this.orderItem.distribution){t.next=8;break}return t.next=7,this.findProductInInventory(this.orderItem.product);case 7:this.inventoryItems.length>0&&(this.selectedInventoryItem=_.find(this.inventoryItems,(function(t){return t.product.id==r.orderItem.product.id})));case 8:this.$nextTick((function(){return r.$bvModal.show(r.modalId)}));case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),loadCustomers:function(t,e){var r=this,n=this.$fb.customerCollection.limit(5).orderBy("name");return t&&(n=n.where("nameSearch","array-contains",t.toLowerCase().trim())),e&&(n=n.startAfter(e)),n.get().then((function(t){var e=[];return t.empty||(r.lastSugCustomerVisible=_.last(t.docs),t.forEach((function(t){e.push(t.data())}))),e}))},sugCustomersFocused:function(){var t=this;0==this.sugCustomers.length&&this.loadCustomers().then((function(e){return e.forEach((function(e){return t.sugCustomers.push(e)}))}))},sugCustomersInputChanged:function(t){var e=this;this.customerSugSearchText=t,this.sugCustomers=[],this.lastSugCustomerVisible=void 0,gt&&window.clearTimeout(gt),gt=this.loadCustomers(t).then((function(t){t.forEach((function(t){return e.sugCustomers.push(t)}))}))},loadMoreSugCustomers:function(t){var e=this;this.isLoadingMoreSugCustomer||(this.isLoadingMoreSugCustomer=!0,this.loadCustomers(this.customerSugSearchText,this.lastSugCustomerVisible).then((function(t){t.forEach((function(t){return e.sugCustomers.push(t)})),e.isLoadingMoreSugCustomer=!1})))},sugProductsFocused:function(){var t=this;0==this.sugProducts.length&&this.loadProducts().then((function(e){return e.forEach((function(e){return t.sugProducts.push(e)}))}))},sugProductsInputChanged:function(t){var e=this;this.productSugSearchText=t,this.sugProducts=[],this.lastSugProductVisible=void 0,bt&&window.clearTimeout(bt),bt=this.loadProducts(t).then((function(t){t.forEach((function(t){return e.sugProducts.push(t)}))}))},loadMoreSugProducts:function(t){var e=this;this.isLoadingMoreSugProduct||(this.isLoadingMoreSugProduct=!0,this.loadProducts(this.productSugSearchText,this.lastSugProductVisible).then((function(t){t.forEach((function(t){return e.sugProducts.push(t)})),e.isLoadingMoreSugProduct=!1})))},loadProducts:function(t,e){var r=this,n=this.$fb.productCollection.limit(5).orderBy("name");return t&&(n=n.where("nameSearch","array-contains",t.toLowerCase().trim())),e&&(n=n.startAfter(e)),n.get().then((function(t){var e=[];return t.empty||(r.lastSugProductVisible=_.last(t.docs),t.forEach((function(t){e.push(t.data())}))),e}))},sugProductsItemSelected:function(t){this.orderItem.product.id==t.id?this.orderItem.rndPrice=this.orderItem.rndPrice||t.rndPrice:this.orderItem.rndPrice=t.rndPrice,this.findProductInInventory(t)},findProductInInventory:function(t){var e=this;if(t.id)return this.inventoryItems=[],this.selectedInventoryItem=void 0,this.$fb.inventoryCollection.where("product.id","==",t.id).get().then((function(t){return t.empty?[]:t.docs.map((function(t){return t.data()}))})).then((function(t){return e.inventoryItems=t}))},setLabel:function(t){return t.name},saveOrderItem:function(){this.$emit("save-order-item",this.orderItem,this.selectedInventoryItem),this.$bvModal.hide(this.id)},selectedInventoryItemChanged:function(t,e){t&&this.orderItem.quantity>e.quantity&&(this.orderItem.quantity=e.quantity)}}},gr=br,yr=Object(l["a"])(gr,ur,lr,!1,null,null,null),_r=yr.exports,Cr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{attrs:{id:t.idName},on:{click:t.generate}},[t._t("default",[t._v("Download "+t._s(t.name))])],2)},kr=[],wr=(r("6aa2"),r("ac4d"),r("7618")),Pr=(r("456d"),r("aeb1")),xr=r.n(Pr),Sr={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,required:!1},exportFields:{type:Object,required:!1},defaultValue:{type:String,required:!1,default:""},title:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:function(){return[]}},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function}},computed:{idName:function(){var t=(new Date).getTime();return"export_"+t},downloadFields:function(){return void 0!==this.fields?this.fields:void 0!==this.exportFields?this.exportFields:void 0}},methods:{generate:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("function"!==typeof this.beforeGenerate){t.next=3;break}return t.next=3,this.beforeGenerate();case 3:if(e=this.data,"function"!==typeof this.fetch&&e){t.next=8;break}return t.next=7,this.fetch();case 7:e=t.sent;case 8:if(e&&e.length){t.next=10;break}return t.abrupt("return");case 10:if(r=this.getProcessedJson(e,this.downloadFields),"html"!==this.type){t.next=15;break}return t.abrupt("return",this.export(this.jsonToXLS(r),this.name.replace(".xls",".html"),"text/html"));case 15:if("csv"!==this.type){t.next=17;break}return t.abrupt("return",this.export(this.jsonToCSV(r),this.name.replace(".xls",".csv"),"application/csv"));case 17:return t.abrupt("return",this.export(this.jsonToXLS(r),this.name,"application/vnd.ms-excel"));case 18:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),export:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r,n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=this.base64ToBlob(e,n),"function"!==typeof this.beforeFinish){t.next=4;break}return t.next=4,this.beforeFinish();case 4:xr()(i,r,n);case 5:case"end":return t.stop()}}),t,this)})));function e(e,r,n){return t.apply(this,arguments)}return e}(),jsonToXLS:function(t){var e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',r="<thead>",n=Object.keys(t[0]).length,i=this;for(var s in null!=this.title&&(r+=this.parseExtraData(this.title,'<tr><th colspan="'+n+'">${data}</th></tr>')),r+="<tr>",t[0])r+="<th>"+s+"</th>";return r+="</tr>",r+="</thead>",r+="<tbody>",t.map((function(t,e){for(var n in r+="<tr>",t)r+="<td>"+i.valueReformattedForMultilines(t[n])+"</td>";r+="</tr>"})),r+="</tbody>",null!=this.footer&&(r+="<tfoot>",r+=this.parseExtraData(this.footer,'<tr><td colspan="'+n+'">${data}</td></tr>'),r+="</tfoot>"),e.replace("${table}",r).replace("${worksheet}",this.worksheet)},jsonToCSV:function(t){var e=[];for(var r in null!=this.title&&e.push(this.parseExtraData(this.title,"${data}\r\n")),t[0])e.push(r),e.push(",");return e.pop(),e.push("\r\n"),t.map((function(t){for(var r in t){var n='="'+t[r]+'"';n.match(/[,"\n]/)&&(n='"'+n.replace(/\"/g,'""')+'"'),e.push(n),e.push(",")}e.pop(),e.push("\r\n")})),null!=this.footer&&e.push(this.parseExtraData(this.footer,"${data}\r\n")),e.join("")},getProcessedJson:function(t,e){var r=this.getKeys(t,e),n=[],i=this;return t.map((function(t,e){var s={};for(var a in r){var o=r[a];s[a]=i.getValue(o,t)}n.push(s)})),n},getKeys:function(t,e){if(e)return e;var r={};for(var n in t[0])r[n]=n;return r},parseExtraData:function(t,e){var r="";if(Array.isArray(t))for(var n=0;n<t.length;n++)r+=e.replace("${data}",t[n]);else r+=e.replace("${data}",t);return r},getValue:function(t,e){var r="object"!==Object(wr["a"])(t)?t:t.field,n="string"!==typeof r?[]:r.split("."),i=this.defaultValue;return i=r?n.length>1?this.getValueFromNestedItem(e,n):this.parseValue(e[r]):e,t.hasOwnProperty("callback")&&(i=this.getValueFromCallback(i,t.callback)),i},valueReformattedForMultilines:function(t){return"string"==typeof t?t.replace(/\n/gi,"<br/>"):t},getValueFromNestedItem:function(t,e){var r=t,n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var c=a.value;r&&(r=r[c])}}catch(u){i=!0,s=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return this.parseValue(r)},getValueFromCallback:function(t,e){if("function"!==typeof e)return this.defaultValue;var r=e(t);return this.parseValue(r)},parseValue:function(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob:function(t,e){var r=window.btoa(window.unescape(encodeURIComponent(t))),n=atob(r),i=n.length,s=new Uint8ClampedArray(i);while(i--)s[i]=n.charCodeAt(i);return new Blob([s],{type:e})}}},Ir=Sr,Or=Object(l["a"])(Ir,Cr,kr,!1,null,null,null),$r=Or.exports,Tr={name:"OrderDetail",components:{numberInput:Se,vndPrice:I,productDetail:$t,orderDetailEditItem:_r,viewPort:R,ShowSupplierPrices:At,JsonExcel:$r},data:function(){return{order:[],counter:{},selectedOrderItem:void 0,fields:[{key:"index",label:"#"},{key:"customer.name",label:"Customer",sortable:!0},{key:"product.name",label:"Product"},{key:"price",label:"Price",class:"text-right"},{key:"quantity",label:"Quantity",class:"text-right"},{key:"total",label:"Total",class:"text-right"},{key:"collectedQuantity",label:"Collected Qty",class:"text-center order-detail-collected-quantity"},{key:"collected",label:"Collected",class:"text-center"},{key:"action",class:"text-right"}],mobileFields:[{key:"index",label:""}],product:{},jsonFields:{Name:"name",Quantity:"quantity"}}},mounted:function(){this.loadOrder()},watch:{},computed:{sumQuantity:function(){return this.order.items&&0!=this.order.items.length?this.order.items.reduce((function(t,e){return t+e.quantity}),0):0},sumCollectedQuantity:function(){return this.order.items&&0!=this.order.items.length?this.order.items.reduce((function(t,e){return t+(e.collectedQuantity||0)}),0):0},sumTotal:function(){return this.order.items&&0!=this.order.items.length?this.order.items.reduce((function(t,e){return t+parseFloat(e.rndPrice||e.product.rndPrice)*parseFloat(e.quantity)}),0):0},jsonData:function(){if(!this.order||!this.order.items||0==this.order.items.length)return[];var t=cr.a.chain(this.order.items).map((function(t){return{name:t.product.name,quantity:t.quantity}})).groupBy((function(t){return t.name})).mapValues((function(t,e){return{name:cr.a.first(t).name,quantity:cr.a.sumBy(t,(function(t){return t.quantity}))}})).values().orderBy((function(t){return t.name})).value();return t.push({name:"Total",quantity:cr.a.sumBy(t,(function(t){return t.quantity}))}),t}},methods:Object(g["a"])({},Object(xt["b"])("order",["getOrderById","addOrUpdateOrder"]),{loadOrder:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.$route.params.id,this.$fb.orderCollection.doc(e).onSnapshot((function(t){t.empty||(r.order=t.data(),r.order.items=cr.a.sortBy(r.order.items||[],(function(t){return t.dateCreated})))}));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addNewOrderItem:function(){this.selectedOrderItem={id:(new Date).getTime(),customer:{name:""},product:{name:""},quantity:1,collectedQuantity:0},this.$refs.editItemModal.open(this.selectedOrderItem)},orderItemClicked:function(t){},editOrderItem:function(t){this.selectedOrderItem=Object(g["a"])({},t),this.selectedOrderItem.oriPrice=this.selectedOrderItem.oriPrice||this.selectedOrderItem.product.oriPrice,this.selectedOrderItem.rndPrice=this.selectedOrderItem.rndPrice||this.selectedOrderItem.product.rndPrice,this.$refs.editItemModal.open(this.selectedOrderItem)},deleteOrderItem:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=cr.a.find(this.order.items,(function(t){return t.id==e.id})),r&&this.$bvModal.msgBoxConfirm("Are you sure you want to delete [".concat(r.quantity," - ").concat(r.product.name,"] of [").concat(r.customer.name,"]?")).then(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(r){var n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=16;break}if(!e.distribution){t.next=12;break}return t.next=4,i.$fbServices.inventoryService.get(e.distribution.inventoryId);case 4:return n=t.sent,n.quantity+=parseFloat(e.quantity),t.next=8,i.$fbServices.inventoryService.set(n);case 8:return i.showMessage("Inventory updated!"),t.next=11,i.$fbServices.distributionService.delete(e.distribution.id);case 11:i.showMessage("Distribution deleted!");case 12:s=cr.a.findIndex(i.order.items,(function(t){return t.id==e.id})),i.order.items.splice(s,1),i.saveOrder(),i.selectedOrderItem=void 0;case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.log(t)}));case 2:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),saveOrderItem:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.product){t.next=2;break}return t.abrupt("return");case 2:if(e.customer){t.next=4;break}return t.abrupt("return");case 4:if(delete e.customer.nameSearch,delete e.product.nameSearch,e.quantity=parseFloat(e.quantity),this.order.items=this.order.items||[],!r){t.next=23;break}return t.next=11,this.$fbServices.distributionService.set(r,this.order,e);case 11:return n=t.sent,this.showMessage("Distribution created!"),e.distribution=n,r.distributions||(r.distributions=[]),r.distributions.push(n),r.quantity-=n.quantity,t.next=19,this.$fbServices.inventoryService.set(r,n);case 19:this.showMessage("Inventory item quantity updated!"),e.product=r.product,e.collectedQuantity=e.quantity,e.collected=!0;case 23:return i=this.order.items.findIndex((function(t){return t.id==e.id})),i>-1?(e.dateModified=new Date,this.order.items.splice(i,1,e)):(e.dateCreated=new Date,this.order.items.push(e)),t.next=27,this.$fb.orderCollection.doc(this.order.id).set(this.order);case 27:this.selectedOrderItem=void 0,this.showMessage("Order saved!");case 29:case"end":return t.stop()}}),t,this)})));function e(e,r){return t.apply(this,arguments)}return e}(),calculateTotalOrderItem:function(t){return parseFloat(t.quantity)*parseFloat(t.rndPrice||t.product.rndPrice)},collectedChanged:function(t,e){e.collected=t,e.collectedQuantity=t?e.quantity:0;var r=this.order.items.findIndex((function(t){return t.id==e.id}));r>-1&&(e.dateModified=new Date,this.order.items.splice(r,1,e),this.saveOrder())},goToCollectionPage:function(){this.$router.push({name:"OrderDetailCollection",params:{id:this.order.id}})},goToShipmentPage:function(){this.$router.push({name:"OrderDetailShipment",params:{id:this.order.id}})},goToOrderList:function(){this.$router.push({name:"Orders"})},collectedQuantityChanged:function(t,e){t.collectedQuantity=e,t.collected=t.collectedQuantity==t.quantity,this.saveOrder()},saveOrder:function(){var t=this;yt&&window.clearTimeout(yt),yt=window.setTimeout((function(){return t.$fb.orderCollection.doc(t.order.id).set(t.order).then((function(){return t.showMessage("Order saved!")}))}),700)},showProductDetailModal:function(t){var e=this;this.selectedOrderItem=t;var r=t.product.id;this.$fb.productCollection.doc(r).get().then((function(t){e.product=t.data(),e.$refs.productDetail.open(e.product)}))},productSaved:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.selectedOrderItem){t.next=8;break}if(this.selectedOrderItem.product=e,r=this.order.items.findIndex((function(t){return t.id==n.selectedOrderItem.id})),!(r>-1)){t.next=7;break}return this.order.items.splice(r,1,this.selectedOrderItem),t.next=7,this.saveOrder();case 7:this.selectedOrderItem=void 0;case 8:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),printDeliverySheet:function(){}})},Dr=Tr,Er=(r("bd12"),Object(l["a"])(Dr,sr,ar,!1,null,"7c35a2a2",null)),Mr=Er.exports,jr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("b-link",{on:{click:t.goToOrderList}},[r("i",{staticClass:"fa fa-server"}),t._v(" Order: ")]),r("strong",[t._v(t._s(t.order.name))]),r("div",{staticClass:"pull-right"},[r("b-link",{on:{click:t.goToOrderDetailPage}},[t._v("Order Detail Page")])],1)],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("div",[r("b-table",{attrs:{"foot-clone":"",responsive:"sm",items:t.items,fields:t.fields,small:!0,hover:!0,selectable:"","select-mode":"single"},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(total)",fn:function(e){return[t._v(t._s(t._f("currency")(t.calculateTotalOrderItem(e.item),t.vndConfig)))]}},{key:"cell(name)",fn:function(e){return[t._v(" "+t._s(e.item.name)+" "),e.item.cwProductId?r("b-link",{attrs:{href:t.appSettings.cwBuyProductUrl.replace("{id}",e.item.cwProductId),target:"_blank"}},[t._v("[Buy CW]")]):t._e(),r("br"),r("show-supplier-prices",{attrs:{product:e.item.product}})]}},{key:"cell(collectedQuantity)",fn:function(e){return[r("number-input",{attrs:{min:0,max:e.item.quantity,inline:"",controls:"",center:"",size:"sm"},on:{change:function(r){return t.collectedQuantityChanged(e.item,r)}},model:{value:e.item.collectedQuantity,callback:function(r){t.$set(e.item,"collectedQuantity",r)},expression:"data.item.collectedQuantity"}})]}},{key:"cell(collected)",fn:function(e){return[r("b-form-checkbox",{on:{change:function(r){return t.collectedChanged(r,e.item)}},model:{value:e.item.collected,callback:function(r){t.$set(e.item,"collected",r)},expression:"data.item.collected"}})]}},{key:"cell(action)",fn:function(e){return[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"danger"},on:{click:function(r){return t.deleteOrderItem(e.item)}}},[r("i",{staticClass:"fa fa-remove"}),t._v(" Delete ")])]}},{key:"foot()",fn:function(t){}},{key:"foot(quantity)",fn:function(e){return[t._v(t._s(t.sumQuantity))]}},{key:"foot(collectedQuantity)",fn:function(e){return[t._v(t._s(t.sumCollectedQuantity))]}}])})],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("b-table",{attrs:{"foot-clone":"",responsive:"sm",items:t.items,fields:t.mobileFields,small:!0},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[r("b-row",[r("b-col",[r("strong",[t._v(t._s(e.index+1)+". "+t._s(e.item.name))]),e.item.cwProductId?r("b-link",{staticClass:"ml-1",attrs:{href:t.appSettings.cwBuyProductUrl.replace("{id}",e.item.cwProductId),target:"_blank"}},[t._v("[Buy CW]")]):t._e(),r("br"),r("show-supplier-prices",{attrs:{product:e.item.product}})],1)],1),r("b-row",[r("b-col",[t._v(" Quantity: "),r("strong",[t._v(t._s(e.item.quantity))]),t._v(" ("+t._s(e.item.customerNameQty)+") ")])],1),r("b-row",{staticClass:"mt-2"},[r("b-col",{attrs:{cols:"6"}},[r("number-input",{attrs:{min:0,max:e.item.quantity,inline:"",controls:"",center:"",size:"sm"},on:{change:function(r){return t.collectedQuantityChanged(e.item,r)}},model:{value:e.item.collectedQuantity,callback:function(r){t.$set(e.item,"collectedQuantity",r)},expression:"data.item.collectedQuantity"}})],1),r("b-col",{staticClass:"text-center",staticStyle:{"padding-top":"5px"},attrs:{cols:"6"}},[r("b-form-checkbox",{on:{change:function(r){return t.collectedChanged(r,e.item)}},model:{value:e.item.collected,callback:function(r){t.$set(e.item,"collected",r)},expression:"data.item.collected"}})],1)],1)]}},{key:"foot()",fn:function(e){return[r("hr"),r("b-row",[r("b-col",[t._v("Quantity")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t.sumQuantity))])],1),r("b-row",[r("b-col",[t._v("Collected Qty")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t.sumCollectedQuantity))])],1)]}}])})]},proxy:!0}])})],1)],1)],1)],1)},qr=[],Rr={name:"OrderDetail",components:{numberInput:Se,viewPort:R,ShowSupplierPrices:At},data:function(){return{order:{},items:[],fields:[{key:"index",label:"#",class:"collection-index"},{key:"name",label:"Product",class:"collection-name"},{key:"customerNameQty",label:"Detail",class:"collection-detail"},{key:"quantity",label:"Quantity",class:"text-right collection-qty"},{key:"collectedQuantity",label:"Collected Qty",class:"text-center collection-collected-qty"},{key:"collected",label:"Collected",class:"text-center collection-collected"}],mobileFields:[{key:"index",label:""}]}},mounted:function(){this.loadOrder()},computed:{sumQuantity:function(){return this.items&&0!==this.items.length?cr.a.sumBy(this.items,(function(t){return t.quantity})):0},sumCollectedQuantity:function(){return this.items&&0!==this.items.length?cr.a.sumBy(this.items,(function(t){return t.collectedQuantity})):0}},methods:{loadOrder:function(){var t=this;this.$fb.orderCollection.doc(this.$route.params.id).onSnapshot((function(e){e.empty||(t.order=e.data(),t.items=cr.a.chain(t.order.items).map((function(t){return{id:t.id,name:t.product.name,cwProductId:t.product.cwProductId,quantity:t.quantity,collectedQuantity:t.collectedQuantity,product:t.product,collected:t.collected,customerName:t.customer.name}})).groupBy((function(t){return t.name})).mapValues((function(t){var e={name:cr.a.first(t).name,product:cr.a.first(t).product,cwProductId:cr.a.first(t).cwProductId,quantity:cr.a.sumBy(t,(function(t){return parseFloat(t.quantity)})),collectedQuantity:cr.a.sumBy(t,(function(t){return parseFloat(t.collectedQuantity)})),orderItemIds:cr.a.reduce(t,(function(t,e){return t.concat(e.id)}),[]),customerNameQty:cr.a.map(t,(function(t){return t.customerName+": "+t.quantity})).join(", ")};return e.collected=e.quantity==e.collectedQuantity,e})).values().orderBy("name").value())}))},goToOrderDetailPage:function(){this.$router.push({name:"OrderDetail",params:{id:this.order.id}})},collectedChanged:function(t,e){e.collectedQuantity=t?e.quantity:0,this.setCollectedItem(e)},setCollectedItem:function(t){var e=t.orderItemIds,r=t.collectedQuantity;this.order.items.filter((function(t){return e.indexOf(t.id)>-1})).forEach((function(t){t.collectedQuantity=0,t.collected=!1,r>0&&(r>t.quantity?(t.collectedQuantity=t.quantity,t.collected=!0,r-=t.quantity):(t.collectedQuantity=r,r=0,t.collected=t.collectedQuantity==t.quantity))})),this.debounceSaveOrder()},goToOrderList:function(){this.$router.push({name:"Orders"})},collectedQuantityChanged:function(t,e){t.collectedQuantity=e,this.setCollectedItem(t)},debounceSaveOrder:function(){var t=this;_t&&window.clearTimeout(_t),_t=window.setTimeout((function(){return t.$fb.orderCollection.doc(t.order.id).set(t.order)}),500)}}},Fr=Rr,Ar=Object(l["a"])(Fr,jr,qr,!1,null,null,null),Lr=Ar.exports,Br=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("b-link",{on:{click:t.goToOrderList}},[r("i",{staticClass:"fa fa-server"}),t._v(" Order: ")]),r("strong",[t._v(t._s(t.order.name))]),t.isAdmin?r("div",{staticClass:"pull-right"},[r("b-link",{staticClass:"mr-1",on:{click:t.updateCustomerInformation}},[t._v("Update Customer Information |")]),r("b-link",{on:{click:t.goToOrderDetailPage}},[t._v("Order Detail Page")])],1):t._e()],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("div",[r("b-table",{attrs:{"foot-clone":"",responsive:"sm",items:t.items,fields:t.fields,small:!0,hover:!0,selectable:"","select-mode":"single"},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(customerName)",fn:function(e){return[r("b-link",{on:{click:function(r){return t.editCustomer(e)}}},[t._v(t._s(e.value))]),e.item.customerId?t._e():r("b-link",{staticClass:"ml-1",on:{click:function(r){return t.updateCustomer(e.item)}}},[t._v("[Update Info]")]),r("b-link",{staticClass:"ml-1",on:{click:function(r){return t.goToCustomerOrder(e.item)}}},[t._v("[Orders]")])]}},{key:"cell(products)",fn:function(e){return[r("table",{staticClass:"table table-borderless product-table"},t._l(e.item.products,(function(e,n){return r("tr",{key:n},[r("td",[t._v(t._s(e.productName))]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}},[t._v(t._s(e.quantity))]),r("td",{staticClass:"text-right",staticStyle:{width:"25%"}},[t._v(t._s(t._f("currency")(e.total,t.vndConfig)))])])})),0)]}},{key:"cell(productPrice)",fn:function(e){return t._l(e.item.products,(function(e,n){return r("div",{key:n},[r("span",[t._v(t._s(t._f("currency")(e.total,t.vndConfig)))])])}))}},{key:"cell(quantity)",fn:function(e){return[r("strong",[t._v(t._s(e.value))])]}},{key:"cell(total)",fn:function(e){return[r("strong",[t._v(t._s(t._f("currency")(e.value,t.vndConfig)))])]}},{key:"cell(purchased)",fn:function(e){return[r("b-form-checkbox",{on:{change:function(r){return t.purchasedChanged(r,e)}},model:{value:e.item.purchased,callback:function(r){t.$set(e.item,"purchased",r)},expression:"data.item.purchased"}})]}},{key:"cell(action)",fn:function(e){return[r("b-button",{attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editShipmentItem(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")])]}},{key:"foot()",fn:function(t){}},{key:"foot(quantity)",fn:function(e){return[t._v(t._s(t.sumQuantity))]}},{key:"foot(total)",fn:function(e){return[t._v(t._s(t._f("currency")(t.sumTotal,t.vndConfig)))]}},{key:"foot(purchased)",fn:function(e){return[t._v(t._s(t._f("currency")(t.sumPurchased,t.vndConfig)))]}}])})],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("b-table",{attrs:{"foot-clone":"",responsive:"sm",items:t.items,fields:t.mobileFields,small:!0,hover:!0},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[r("b-row",[r("b-col",[r("strong",[t._v(t._s(e.index+1)+". "+t._s(e.item.customerName))]),r("b-link",{staticClass:"ml-1",on:{click:function(r){return t.editCustomer(e)}}},[t._v("[Edit]")]),e.item.customerId?t._e():r("b-link",{staticClass:"ml-1",on:{click:function(r){return t.updateCustomer(e.item)}}},[t._v("[Update Info]")])],1)],1),r("b-row",[r("b-col",[r("table",{staticClass:"table table-borderless product-table"},[t._l(e.item.products,(function(e,n){return r("tr",{key:n},[r("td",[t._v(t._s(e.productName))]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}},[t._v(t._s(e.quantity))]),r("td",{staticClass:"text-right",staticStyle:{width:"30%"}},[t._v(t._s(t._f("currency")(e.total,t.vndConfig)))])])})),r("tr",{staticStyle:{"border-top":"1px dashed #e4e7ea !important"}},[r("td",[t._v("Total")]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}},[t._v(t._s(e.item.quantity))]),r("td",{staticClass:"text-right",staticStyle:{width:"30%"}},[t._v(t._s(t._f("currency")(e.item.total,t.vndConfig)))])]),r("tr",[r("td",[t._v("Purchased")]),r("td",{staticClass:"text-right",staticStyle:{width:"5%"}}),r("td",{staticClass:"text-center",staticStyle:{width:"30%"}},[r("b-form-checkbox",{on:{change:function(r){return t.purchasedChanged(r,e)}},model:{value:e.item.purchased,callback:function(r){t.$set(e.item,"purchased",r)},expression:"data.item.purchased"}})],1)])],2)])],1),r("fieldset",{staticClass:"my-fieldset",staticStyle:{"margin-top":"10px"}},[r("b-row",[r("b-col",[t._v(" Note: "+t._s(e.item.note)+" "),r("br"),t._v(" Address: "+t._s(e.item.address)+" "),r("br"),t._v(" Phone: "+t._s(e.item.phone)+" "),r("br"),r("b-link",{on:{click:function(r){return t.editShipmentItem(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")])],1)],1)],1)]}},{key:"foot()",fn:function(e){return[r("hr"),r("b-row",[r("b-col",[t._v("Quantity")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t.sumQuantity))])],1),r("b-row",[r("b-col",[t._v("Total")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.sumTotal,t.vndConfig)))])],1),r("b-row",[r("b-col",[t._v("Purchased")]),r("b-col",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.sumPurchased,t.vndConfig)))])],1)]}}])})]},proxy:!0}])})],1)],1)],1),r("order-detail-shipment-edit-item",{attrs:{id:"shipmentEditItem",item:t.selectedShipmentItem},on:{saveShipmentItem:t.saveShipmentItem}}),r("customer-edit",{attrs:{id:"customerEdit",item:this.selectedCustomer}})],1)},Nr=[],Vr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{attrs:{id:t.id,title:"Shipment Item",size:"lg"},on:{ok:t.saveShipmentItem}},[r("b-row",[r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Note")]),r("b-form-input",{attrs:{type:"text"},model:{value:t.shipmentItem.note,callback:function(e){t.$set(t.shipmentItem,"note",e)},expression:"shipmentItem.note"}})],1)],1),r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Address")]),r("b-form-input",{attrs:{type:"text"},model:{value:t.shipmentItem.address,callback:function(e){t.$set(t.shipmentItem,"address",e)},expression:"shipmentItem.address"}})],1)],1),r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Phone")]),r("b-form-input",{attrs:{type:"text"},model:{value:t.shipmentItem.phone,callback:function(e){t.$set(t.shipmentItem,"phone",e)},expression:"shipmentItem.phone"}})],1)],1)],1)],1)},Qr=[],zr={name:"OrderDetail",props:["id","item"],components:{},data:function(){return{shipmentItem:{}}},watch:{item:function(t){this.shipmentItem=t||{}}},mounted:function(){},computed:{},methods:{saveShipmentItem:function(){this.$emit("saveShipmentItem",this.shipmentItem),this.$bvModal.hide(this.id)}}},Wr=zr,Hr=Object(l["a"])(Wr,Vr,Qr,!1,null,"7c39920c",null),Ur=Hr.exports,Yr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{attrs:{id:t.id,title:"Customer Detail",size:"lg"},on:{ok:t.saveCustomer}},[r("b-row",[r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Name")]),r("b-form-input",{attrs:{type:"text"},model:{value:t.customer.name,callback:function(e){t.$set(t.customer,"name",e)},expression:"customer.name"}})],1)],1),r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Address")]),r("b-form-input",{attrs:{type:"text"},model:{value:t.customer.address,callback:function(e){t.$set(t.customer,"address",e)},expression:"customer.address"}})],1)],1),r("b-col",{attrs:{sm:"12"}},[r("b-form-group",[r("label",[t._v("Phone")]),r("b-form-input",{attrs:{type:"text"},model:{value:t.customer.phone,callback:function(e){t.$set(t.customer,"phone",e)},expression:"customer.phone"}})],1)],1)],1)],1)},Kr=[],Gr={name:"CustomerEdit",props:["id","item"],components:{},data:function(){return{customer:{}}},watch:{item:function(t){var e=this;this.customer=t||{},this.customer.id&&this.$fb.customerCollection.doc(this.customer.id).get().then((function(t){return e.customer=t.data()}))}},mounted:function(){},computed:{},methods:{saveCustomer:function(){var t=this;this.customer.nameSearch=O(this.customer.name),this.customer.version=(this.customer.version||0)+1,this.$fb.customerCollection.doc(this.customer.id).set(this.customer).then((function(){t.$emit("customerSaved",t.customer),t.$bvModal.hide(t.id)}))}}},Jr=Gr,Xr=Object(l["a"])(Jr,Yr,Kr,!1,null,"2daaf116",null),Zr=Xr.exports,tn={name:"OrderDetail",components:{numberInput:Se,orderDetailShipmentEditItem:Ur,customerEdit:Zr,viewPort:R},data:function(){return{isAdmin:!1,order:{},items:[],selectedShipmentItem:{},selectedCustomer:{},fields:[{key:"index",label:"#",class:"shipment-index-col"},{key:"customerName",label:"Customer",class:"shipment-customer-col"},{key:"products",label:"Products",class:"shipment-product-col"},{key:"quantity",label:"Total Qty",class:"text-center shipment-quantity-col",tdClass:"vertical-middle"},{key:"total",label:"Total Price",class:"text-right shipment-price-col"},{key:"purchased",label:"Purchased",class:"text-center shipment-purchased-col"},{key:"note",label:"Note",class:"shipment-note-col"},{key:"address",label:"Address",class:"shipment-address-col"},{key:"phone",label:"Phone",class:"shipment-phone-col"},{key:"action",label:"Action",class:"text-right shipment-action-col"}],mobileFields:[{key:"index",label:""}]}},mounted:function(){this.isAdmin=this.$fb.isAdmin(),this.loadOrder()},computed:{sumQuantity:function(){return this.items&&0!==this.items.length?cr.a.sumBy(this.items,(function(t){return t.quantity})):0},sumTotal:function(){return this.items&&0!==this.items.length?cr.a.sumBy(this.items,(function(t){return t.total})):0},sumPurchased:function(){return this.items&&0!==this.items.length?cr.a.chain(this.items).filter((function(t){return t.purchased})).sumBy((function(t){return t.total})).value():0}},methods:{loadOrder:function(){var t=this;this.$fb.orderCollection.doc(this.$route.params.id).onSnapshot((function(e){e.empty||(t.order=e.data(),t.buildItems(t.order))}))},buildItems:function(t){this.items=cr.a.chain(t.items).map((function(t){return{id:t.id,customerId:t.customer.id,note:t.note,customerName:t.customer.name,address:t.customer.address,phone:t.customer.phone,purchased:t.purchased,productName:t.product.name,quantity:t.quantity,rndPrice:t.rndPrice||t.product.rndPrice,total:parseFloat(t.quantity||0)*parseFloat(t.rndPrice||t.product.rndPrice||0)}})).groupBy((function(t){return t.customerName})).mapValues((function(t){var e={note:cr.a.first(t).note,customerId:cr.a.first(t).customerId,customerName:cr.a.first(t).customerName,address:cr.a.first(t).address,phone:cr.a.first(t).phone,purchased:cr.a.first(t).purchased,quantity:cr.a.sumBy(t,(function(t){return t.quantity})),total:cr.a.sumBy(t,(function(t){return t.total})),products:cr.a.reduce(t,(function(t,e){return t.concat(e)}),[])};return e})).values().sortBy((function(t){return t.customerName})).value()},goToOrderDetailPage:function(){this.$router.push({name:"OrderDetail",params:{id:this.order.id}})},collectedChanged:function(t,e){e.collectedQuantity=t?e.quantity:0,this.setCollectedItem(e)},setCollectedItem:function(t){var e=t.orderItemIds,r=t.collectedQuantity;this.order.items.filter((function(t){return e.indexOf(t.id)>-1})).forEach((function(t){t.collectedQuantity=0,t.collected=!1,r>0&&(r>t.quantity?(t.collectedQuantity=t.quantity,t.collected=!0,r-=t.quantity):(t.collectedQuantity=r,r=0,t.collected=t.collectedQuantity==t.quantity))})),this.debounceSaveOrder()},goToOrderList:function(){this.$router.push({name:"Orders"})},collectedQuantityChanged:function(t,e){t.collectedQuantity=e,this.setCollectedItem(t)},debounceSaveOrder:function(){var t=this;console.log(this.order),Ct&&window.clearTimeout(Ct),Ct=window.setTimeout((function(){return t.$fb.orderCollection.doc(t.order.id).set(t.order)}),500)},updateCustomerInformation:function(){var t=this;this.$bvModal.msgBoxConfirm("Are you sure you want to update all Customer's informations?").then((function(e){e&&t.items.forEach(t.updateCustomer)})).catch((function(t){console.log(t)}))},updateCustomer:function(t){var e=this,r=this.$fb.customerCollection;r=t.customerId?r.doc(t.customerId):r.where("name","==",t.customerName),r.get().then((function(e){var r;return r=t.customerId?e.data():cr.a.first(e.docs).data(),delete r.nameSearch,r})).then((function(t){var r=cr.a.keys(cr.a.pickBy(e.order.items,(function(e){return e.customer.id==t.id||e.customer.name==t.name})));return r.forEach((function(r){var n=e.order.items[r];n.customer=t,e.order.items.splice(r,1,n)})),e.$fb.orderCollection.doc(e.order.id).set(e.order),e.order})).then(this.buildItems)},purchasedChanged:function(t,e){var r=this,n=e.index,i=e.item;i.purchased=t,this.items.splice(n,1,i);var s=cr.a.keys(cr.a.pickBy(this.order.items,(function(t){return t.customer.id==i.customerId||t.customer.name==i.customerName})));s.forEach((function(e){return r.order.items[e].purchased=t})),this.debounceSaveOrder()},editShipmentItem:function(t){var e=t.index,r=t.item;this.selectedShipmentItem=Object(g["a"])({},r),this.selectedShipmentItemIndex=e,this.$bvModal.show("shipmentEditItem")},saveShipmentItem:function(t){var e=this;this.items.splice(this.selectedShipmentItemIndex,1,t);var r=cr.a.keys(cr.a.pickBy(this.order.items,(function(e){return e.customer.id==t.customerId||e.customer.name==t.customerName})));r.forEach((function(r){e.order.items[r].note=t.note||"",e.order.items[r].customer.address=t.address||"",e.order.items[r].customer.phone=t.phone||""})),this.debounceSaveOrder()},editCustomer:function(t){t.index;var e=t.item,r=e.customerId,n=e.customerName,i=e.address,s=e.phone;this.selectedCustomer={id:r,name:n,address:i,phone:s},this.$bvModal.show("customerEdit")},goToCustomerOrder:function(t){this.$router.push({name:"CustomerOrders",params:{id:t.customerId}})}}},en=tn,rn=(r("3a20"),Object(l["a"])(en,Br,Nr,!1,null,"3669942c",null)),nn=rn.exports,sn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("i",{staticClass:"cui-user icons font-lg"}),t._v(" "+t._s(t.order.name)+" Statistic ")]),r("b-row",[r("b-col",{attrs:{sm:"12",md:"6"}},[r("table",{staticClass:"table table-response"},[r("tr",{staticClass:"no-border-top"},[r("td",[t._v("Buying")]),r("td",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.totalBuying,t.audConfig)))])]),r("tr",[r("td",[t._v(" Ship VN Fee "),r("a",{attrs:{href:"javascript:void(0)"},on:{click:t.changeShipFee}},[t._v("[Change]")])]),t.isChangingShipFee?r("td",{staticClass:"text-right"},[r("b-input-group",[r("b-form-input",{model:{value:t.order.shipFee,callback:function(e){t.$set(t.order,"shipFee",e)},expression:"order.shipFee"}}),r("b-input-group-append",[r("b-button",{attrs:{variant:"outline-success"},on:{click:t.saveShipFee}},[t._v("Save")])],1)],1)],1):r("td",{staticClass:"text-right"},[t._v("(Est: "+t._s(t._f("currency")(t.estShipPrice,t.audConfig))+") "+t._s(t._f("currency")(t.order.shipFee,t.audConfig)))])]),r("tr",[r("td",[t._v("Total")]),r("td",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.total,t.audConfig)))])]),r("tr",[r("td",[t._v(" Current Rate "),r("a",{attrs:{href:"javascript:void(0)"},on:{click:t.changeCurrentRate}},[t._v("[Change]")])]),t.isChangingCurrentRate?t._e():r("td",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.order.currentRate,t.vndConfig)))]),t.isChangingCurrentRate?r("td",{staticClass:"text-right"},[r("b-input-group",[r("b-form-input",{model:{value:t.order.currentRate,callback:function(e){t.$set(t.order,"currentRate",e)},expression:"order.currentRate"}}),r("b-input-group-append",[r("b-button",{attrs:{variant:"outline-success"},on:{click:t.saveCurrentRate}},[t._v("Save")])],1)],1)],1):t._e()]),r("tr",[r("td",[t._v("Total VND")]),r("td",{staticClass:"text-right"},[t._v(t._s(t._f("currency")(t.totalVND,t.vndConfig)))])]),r("tr",[r("td",[t._v("Profit")]),r("td",{staticClass:"text-right"},[r("strong",[t._v(t._s(t._f("currency")(t.profit,t.vndConfig)))])])])])]),r("b-col",{attrs:{sm:"12",md:"6"}},[r("b-form-group",[r("label",[t._v("Note")]),r("b-form-textarea",{attrs:{placeholder:"Enter something...",rows:"6"},model:{value:t.order.note,callback:function(e){t.$set(t.order,"note",e)},expression:"order.note"}})],1),r("b-button",{attrs:{type:"submit",size:"sm",variant:"success"},on:{click:t.saveOrder}},[t._v("Save")])],1)],1)],1)],1)},an=[],on={name:"Orders",components:{},data:function(){return{order:[],counter:{},totalBuying:0,total:0,totalVND:0,profit:0,estShipPrice:0,isChangingShipFee:!1,isChangingCurrentRate:!1}},mounted:function(){this.loadOrder()},watch:{"$route.params.id":function(){this.loadOrder()}},computed:{},methods:{loadOrder:function(){var t=this,e=this.$route.params.id;this.$fb.orderCollection.doc(e).onSnapshot((function(e){e.empty||(t.order=e.data(),t.calculateStatistic(t.order))}))},calculateStatistic:function(t){this.totalBuying=_.sumBy(t.items,(function(t){return parseFloat(t.product.buyPrice||0)*parseFloat(t.quantity||0)})),this.total=this.totalBuying+(t&&t.shipFee||0),this.estShipPrice=this.sumShippingFee(t),this.totalVND=this.total*(t&&t.currentRate||16500),this.profit=this.sumTotal(t)-this.totalVND},sumQuantity:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity}),0):0},sumTotal:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity*parseFloat(e.rndPrice||e.product.rndPrice)}),0):0},sumShippingFee:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity*parseFloat(e.product.shipPrice||0)}),0):0},changeShipFee:function(){this.isChangingShipFee=!0},changeCurrentRate:function(){this.isChangingCurrentRate=!0},saveShipFee:function(){this.order.shipFee=parseFloat(this.order.shipFee),this.isChangingShipFee=!1,this.saveOrder()},saveCurrentRate:function(){this.order.currentRate=parseFloat(this.order.currentRate),this.saveOrder()},saveOrder:function(){var t=this;this.$fb.orderCollection.doc(this.order.id).set(this.order).then((function(e){t.isChangingCurrentRate=!1}))}}},cn=on,un=(r("a3b2"),Object(l["a"])(cn,sn,an,!1,null,"0fe54fc7",null)),ln=un.exports,dn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[t._v("Calculate Price")]),r("b-form",[r("b-form-group",{attrs:{label:"Price ($A)"}},[r("b-form-input",{attrs:{type:"text",placeholder:"Enter price"},model:{value:t.price,callback:function(e){t.price=e},expression:"price"}})],1),r("b-form-group",{attrs:{label:"Weight(g)",description:"100g = $1"}},[r("b-form-input",{attrs:{type:"text",placeholder:"Enter weight"},model:{value:t.weight,callback:function(e){t.weight=e},expression:"weight"}})],1),r("b-form-group",{attrs:{label:"Suggested Price (Price + 10% + Ship + 2)"}},[t._v(" ("+t._s(t._f("currency")(t.price,t.audConfig))+" + "+t._s(t._f("currency")(.1*t.price,t.audConfig))+" + "+t._s(t._f("currency")(t.weight/100,t.audConfig))+" + "+t._s(t._f("currency")(2,t.audConfig))+") * "+t._s(t._f("currency")(16500,t.vndConfig))+" "),r("strong",[t._v("= "+t._s(t._f("currency")(t.sugPrice,t.vndConfig)))])])],1)],1)],1)},pn=[],mn={name:"Utils",components:{},data:function(){return{price:"",weight:""}},mounted:function(){},computed:{sugPrice:function(){var t=parseFloat(this.price||0),e=parseFloat(this.weight||0);return 16500*(t+.1*t+e/100+2)}},methods:{}},hn=mn,fn=Object(l["a"])(hn,dn,pn,!1,null,null,null),vn=fn.exports,bn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[t._v("Suppliers")]),r("b-list-group",t._l(t.suppliers,(function(e,n){return r("b-list-group-item",{key:n},[e.isEditing?t._e():[r("b-row",[r("b-col",[t._v(" "+t._s(e.code)+" - "+t._s(e.name)+" "),r("span",{staticClass:"pull-right"},[r("b-link",{on:{click:function(r){return t.editSupplier(e,n)}}},[t._v("Edit")]),r("b-link",{staticClass:"ml-1 mr-1"},[t._v("|")]),r("b-link",{on:{click:function(r){return t.removeSupplier(e,n)}}},[t._v("Remove")])],1)])],1)],e.isEditing?[r("b-row",[r("b-col",[r("b-form-input",{attrs:{type:"text",placeholder:"Enter code"},model:{value:e.code,callback:function(r){t.$set(e,"code",r)},expression:"item.code"}})],1),r("b-col",[r("b-form-input",{attrs:{type:"text",placeholder:"Enter name"},model:{value:e.name,callback:function(r){t.$set(e,"name",r)},expression:"item.name"}})],1),r("b-col",{staticStyle:{"padding-top":"10px"}},[r("span",{staticClass:"pull-right"},[r("b-link",{on:{click:function(r){return t.saveSupplier(e,n)}}},[t._v("Save")]),r("b-link",{staticClass:"mr-1 ml-1"},[t._v("|")]),r("b-link",{on:{click:function(r){return t.cancelEdit(e,n)}}},[t._v("Cancel")])],1)])],1)]:t._e()],2)})),1),r("b-button",{staticStyle:{"margin-top":"10px"},attrs:{variant:"success"},on:{click:t.addSupplier}},[t._v("Add Supplier")])],1)],1),r("b-col")],1)],1)},gn=[],yn={name:"Settings",components:{},data:function(){return{price:"",weight:"",suppliers:[]}},mounted:function(){var t=this;this.appSettings.suppliers&&this.appSettings.suppliers.forEach((function(e){return t.suppliers.push(e)}))},computed:{},methods:{removeSupplier:function(t,e){var r=this;this.$bvModal.msgBoxConfirm("Are you sure you want to delete this supplier?").then(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n&&(r.suppliers.splice(e,1),r.appSettings.suppliers=r.suppliers,r.saveSettings());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.log(t)}))},saveSettings:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$fbServices.settingService.setSettings(this.appSettings);case 2:this.showMessage("Settings updated!");case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addSupplier:function(){this.suppliers.push({name:"",code:"",isEditing:!0})},editSupplier:function(t,e){t.isEditing=!0,this.suppliers.splice(e,1,t)},cancelEdit:function(t,e){delete t.isEditing,this.suppliers.splice(e,1,t)},saveSupplier:function(t,e){delete t.isEditing,this.suppliers.splice(e,1,t),this.appSettings.suppliers=this.suppliers,this.saveSettings()}}},_n=yn,Cn=Object(l["a"])(_n,bn,gn,!1,null,null,null),kn=Cn.exports,wn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app flex-row align-items-center"},[r("div",{staticClass:"container"},[r("b-row",{staticClass:"justify-content-center"},[r("b-col",{attrs:{md:"8"}},[r("b-card-group",[r("b-card",{staticClass:"p-4",attrs:{"no-body":""}},[r("b-card-body",[r("b-form",{on:{submit:t.login}},[r("h1",[t._v("Login")]),r("p",{staticClass:"text-muted"},[t._v("Sign In to your account")]),r("b-input-group",{staticClass:"mb-3"},[r("b-input-group-prepend",[r("b-input-group-text",[r("i",{staticClass:"fa fa-user"})])],1),r("b-form-input",{staticClass:"form-control",attrs:{type:"text",placeholder:"Username",autocomplete:"username email"},on:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.login(e):null}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1),r("b-input-group",{staticClass:"mb-4"},[r("b-input-group-prepend",[r("b-input-group-text",[r("i",{staticClass:"fa fa-lock"})])],1),r("b-form-input",{staticClass:"form-control",attrs:{type:"password",placeholder:"Password",autocomplete:"current-password"},on:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.login(e):null}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),t.showError?r("p",[r("i",{staticStyle:{color:"red"}},[t._v("Wrong username or password")])]):t._e(),r("b-row",[r("b-col",{attrs:{cols:"6"}},[r("b-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"px-4",attrs:{variant:"primary"},on:{click:t.login}},[t._v("Login")])],1),r("b-col",{staticClass:"text-right",attrs:{cols:"6"}},[r("b-button",{staticClass:"px-0",attrs:{variant:"link"}},[t._v("Forgot password?")])],1)],1)],1)],1)],1),r("b-card",{staticClass:"text-white bg-primary py-5 d-md-down-none",staticStyle:{width:"44%"},attrs:{"no-body":""}},[r("b-card-body",{staticClass:"text-center"},[r("div",[r("h2",[t._v("Order Management")])])])],1)],1)],1)],1)],1)])},Pn=[],xn={name:"Login",data:function(){return{email:"",password:"",showError:!1,isLoading:!1}},methods:{login:function(){var t=this;this.isLoading=!0,this.$fb.auth.signInWithEmailAndPassword(this.email,this.password).then((function(){t.isLoading=!1,t.$router.replace("dashboard")})).catch((function(e){t.showError=!0,t.isLoading=!1}))}}},Sn=xn,In=Object(l["a"])(Sn,wn,Pn,!1,null,null,null),On=In.exports,$n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("i",{staticClass:"cui-user icons font-lg"}),t._v(" Orders ")]),r("b-table",{attrs:{responsive:"sm",items:t.orders,fields:t.fields,small:!0,selectable:"","select-mode":"single",busy:t.isLoadingData},scopedSlots:t._u([{key:"cell(name)",fn:function(e){return[r("a",{staticStyle:{"font-size":"15px"},attrs:{href:t.buildRoute(e.item),variant:"link"}},[t._v(t._s(e.item.name))])]}},{key:"cell(dateCreated)",fn:function(e){return[t._v(t._s(t._f("date")(e.item.dateCreated.toDate())))]}},{key:"cell(quantity)",fn:function(e){return[t._v(t._s(t.sumQuantity(e.item)))]}},{key:"cell(total)",fn:function(e){return[t._v(t._s(t._f("currency")(t.sumTotal(e.item),t.vndConfig)))]}}])})],1)],1)],1)],1)},Tn=[],Dn={name:"Orders",components:{},data:function(){return{orders:[],selectedOrder:{},isLoadingData:!1,fields:[{key:"name"},{key:"dateCreated",label:"Created Date"},{key:"quantity",label:"Quantity"},{key:"total",label:"Total"}]}},mounted:function(){this.loadOrders()},computed:{},methods:{loadOrders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.orders=[],this.isLoadingData=!0,t.t0=_,t.next=5,this.$store.dispatch("order/getAllOrders");case 5:t.t1=t.sent,t.t2=["dateCreated"],t.t3=["desc"],this.orders=t.t0.orderBy.call(t.t0,t.t1,t.t2,t.t3),this.isLoadingData=!1;case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),sumQuantity:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity}),0):0},sumTotal:function(t){return t.items&&0!=t.items.length?t.items.reduce((function(t,e){return t+e.quantity*parseFloat(e.rndPrice||e.product.rndPrice)}),0):0},buildRoute:function(t){var e=location;e.origin;return this.$router.resolve({name:"OrderDetailShipment",params:{id:t.id}}).href}}},En=Dn,Mn=Object(l["a"])(En,$n,Tn,!1,null,null,null),jn=Mn.exports,qn=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"animated fadeIn"},[r("b-row",[r("b-col",[r("b-card",[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[r("i",{staticClass:"fa fa-book"}),t._v(" Products ("+t._s(t.productCount)+") "),r("b-link",{staticClass:"pull-right",on:{click:t.forceCheckPriceAgain}},[t._v("CW Check Price")])],1)]),t.showCheckPriceProgress?r("div",{staticClass:"mb-5"},[r("p",[t._v("There are "+t._s(t.productsNotCheckedPrice.length)+" products have been out-of-dated, click button 'Start Check Price' to get new price from Chemiswarehourse")]),r("b-progress",{attrs:{value:t.currentProductCheckingIndex,max:t.productsNotCheckedPrice.length,variant:"info",height:"2rem",animated:"","show-value":""}},[r("b-progress-bar",{attrs:{value:t.currentProductCheckingIndex}},[t._v(" Progress: "),r("strong",[t._v(t._s(t.currentProductCheckingIndex)+" / "+t._s(t.productsNotCheckedPrice.length))])])],1),r("p",[t._v("#"+t._s(t.getCWProductId(t.currentProductChecking))+" - "+t._s(t.currentProductChecking.name))]),r("b-button",{attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(e){return t.startCheckPrice()}}},[r("i",{staticClass:"fa fa-line-chart"}),t._v(" Start Check Price ")])],1):t._e(),r("b-form-group",{attrs:{label:"Show only increase/decrease"}},[r("b-form-checkbox",{attrs:{inline:""},on:{change:t.showOnlyDecreaseChange},model:{value:t.filter.showOnlyDecrease,callback:function(e){t.$set(t.filter,"showOnlyDecrease",e)},expression:"filter.showOnlyDecrease"}},[t._v("Show Only Decrease")]),r("b-form-checkbox",{attrs:{inline:""},on:{change:t.showOnlyIncreaseChange},model:{value:t.filter.showOnlyIncrease,callback:function(e){t.$set(t.filter,"showOnlyIncrease",e)},expression:"filter.showOnlyIncrease"}},[t._v("Show Only Increase")])],1),r("view-port",{scopedSlots:t._u([{key:"desktop",fn:function(){return[r("div",[r("b-table",{ref:"trackingProduct",staticClass:"tracking",attrs:{responsive:"sm",items:t.products,fields:t.fields,small:!0,selectable:"","select-mode":"single"},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[t._v(t._s(e.index+1))]}},{key:"cell(name)",fn:function(e){return[r("div",{staticClass:"prod-thumbnail-name"},[r("div",{staticClass:"thumbnail"},[e.item.thumbnail?r("img",{attrs:{src:e.item.thumbnail,width:"50px",height:"50px"}}):t._e()]),r("div",{staticClass:"name-2"},[t._v(" "+t._s(e.value)+" "),r("br"),r("small",[t._v("PID: "+t._s(t.getCWProductId(e.item)))])])])]}},{key:"cell(price)",fn:function(e){return[r("del",[t._v(t._s(t._f("currency")(e.item.cwTracking.oldPrice,t.audConfig)))]),t._v(" "),r("span",{staticStyle:{"font-size":"18px","font-weight":"bold"}},[t._v(t._s(t._f("currency")(e.item.cwTracking.price,t.audConfig)))])]}},{key:"cell(change)",fn:function(e){return["increase"==e.item.cwTracking.priceStatus?r("i",{staticClass:"fa fa-angle-double-up fa-lg",staticStyle:{color:"red","font-size":"24px"},attrs:{"aria-hidden":"true"}}):t._e(),"decrease"==e.item.cwTracking.priceStatus?r("i",{staticClass:"fa fa-angle-double-down fa-lg",staticStyle:{color:"green","font-size":"24px"},attrs:{"aria-hidden":"true"}}):t._e(),t._v(" ("+t._s(e.item.cwTracking.percentage)+"%) ")]}},{key:"cell(lastChecked)",fn:function(e){return[t._v(t._s(t._f("date")(e.item.cwTracking.lastChecked.toDate())))]}},{key:"cell(action)",fn:function(e){return[r("b-button",{staticClass:"mr-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editProduct(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")])]}}])})],1)]},proxy:!0},{key:"mobile",fn:function(){return[r("b-table",{ref:"trackingProduct",staticClass:"tracking",attrs:{responsive:"sm",items:t.products,fields:t.mobileFields,small:!0,selectable:"","select-mode":"single"},scopedSlots:t._u([{key:"cell(index)",fn:function(e){return[r("div",{staticClass:"row"},[r("div",{staticClass:"col-4",staticStyle:{overflow:"hidden"}},[r("img",{staticStyle:{"margin-left":"-30px"},attrs:{src:e.item.thumbnail,width:"150px",height:"150px"}})]),r("div",{staticClass:"col-8"},[r("strong",[t._v(t._s(e.item.name))]),r("br"),r("del",[t._v(t._s(t._f("currency")(e.item.cwTracking.oldPrice,t.audConfig)))]),r("span",{staticClass:"ml-1",staticStyle:{"font-size":"18px","font-weight":"bold"}},[t._v(t._s(t._f("currency")(e.item.cwTracking.price,t.audConfig)))]),"increase"==e.item.cwTracking.priceStatus?r("i",{staticClass:"fa fa-angle-double-up fa-lg ml-1",staticStyle:{color:"red","font-size":"24px"},attrs:{"aria-hidden":"true"}}):t._e(),"decrease"==e.item.cwTracking.priceStatus?r("i",{staticClass:"fa fa-angle-double-down fa-lg",staticStyle:{color:"green","font-size":"24px"},attrs:{"aria-hidden":"true"}}):t._e(),t._v(" ("+t._s(e.item.cwTracking.percentage)+"%) "),r("br"),t._v(" Last checked: "+t._s(t._f("date")(e.item.cwTracking.lastChecked.toDate()))+" "),r("br"),r("b-button",{staticClass:"mt-1",attrs:{type:"submit",size:"sm",variant:"success"},on:{click:function(r){return t.editProduct(e)}}},[r("i",{staticClass:"fa fa-edit"}),t._v(" Edit ")])],1)])]}}])})]},proxy:!0}])}),r("b-row",{staticClass:"load-more"},[r("b-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingMore,expression:"isLoadingMore"}],attrs:{variant:"outline-success"},on:{click:function(e){return t.loadMoreProduct(e)}}},[t._v("Load more")])],1)],1)],1)],1),r("product-detail",{ref:"productDetail",attrs:{id:"productEdit",item:t.product},on:{"product-saved":t.productSaved}})],1)},Rn=[],Fn=r("bd86"),An={name:"Products",components:{productDetail:$t,viewPort:R},data:function(){return{productsNotCheckedPrice:[],currentProductCheckingIndex:0,currentProductChecking:{},products:[],product:{},productBatches:"",useMobileView:!1,searchText:"",pageSize:10,lastVisible:void 0,isLoadingMore:!1,showCheckPriceProgress:!1,fields:[{key:"index",label:"#",class:"index"},Object(Fn["a"])({key:"name",class:"name"},"class","name"),{key:"price",label:"Price",class:"price text-right"},{key:"change",label:"",class:"change text-left"},{key:"lastChecked",label:"Last Checked",class:"text-center last-checked"},{key:"action",label:"Action",class:"action text-right"}],mobileFields:[{key:"index",label:""}],filter:{showOnlyDecrease:!0,showOnlyIncrease:!1}}},mounted:function(){var t=this;t.useMobileView=window.innerWidth<700,window.addEventListener("resize",(function(){t.useMobileView=window.innerWidth<700})),this.getOutDateProducts(),this.getCheckedProducts(null)},watch:{},computed:Object(g["a"])({},Object(xt["c"])("counter",{productCount:function(t){return t.counter&&t.counter.productCount}})),methods:{getCheckedProducts:function(t){var e=this,r=this.$fb.productCollection.where("cwTracking.percentage",">",0).orderBy("cwTracking.percentage","desc");return this.filter.showOnlyDecrease?r=r.where("cwTracking.priceStatus","==","decrease"):this.filter.showOnlyIncrease&&(r=r.where("cwTracking.priceStatus","==","increase")),t&&(r=r.startAfter(t||0)),r.limit(20).get().then((function(t){if(!t.empty)return e.lastVisible=_.last(t.docs),t.forEach((function(t){e.products.push(t.data())})),e.products}))},loadMoreProduct:function(t){var e=this;this.isLoadingMore=!0,this.getCheckedProducts(this.lastVisible).then((function(){return e.isLoadingMore=!1}))},cwCheckPrice:function(){this.$fb.productCollection.where("cwProductId",">","0").orderBy("cwProductId").limit(10).get().then((function(t){return t.empty?[]:_.map(t.docs,(function(t){return t.data()}))})).then((function(t){}))},getOutDateProducts:function(t){var e=this,r=(new Date).setMin();return this.loadCwProducts().then((function(e){return t?e:_.filter(e,(function(t){return!t.cwTracking||!t.cwTracking.lastChecked||t.cwTracking.lastChecked.toDate()<r}))})).then((function(t){console.table(t),e.showCheckPriceProgress=t.length>0,e.productsNotCheckedPrice=t}))},startCheckPrice:function(){this.currentProductCheckingIndex=0,this.currentProductCheckingIndex<this.productsNotCheckedPrice.length&&this.doCheckPrice()},doCheckPrice:function(){var t=this;this.currentProductChecking=this.productsNotCheckedPrice[this.currentProductCheckingIndex];var e=this.currentProductChecking.supplierPrices.find((function(t){return"CW"==t.supplier})).id;return this.$http.get(this.appSettings.cwCheckPriceApi.replace("{term}",e)).then((function(r){if(r&&200==r.status&&r.data){var n=r.data,i=_.find(n,(function(t){return parseFloat(t.id)>0}));if(i&&i.id==e){var s=t.decorateData(i,t.currentProductChecking);console.log(s),t.currentProductChecking.cwTracking=s,t.$fb.productCollection.doc(t.currentProductChecking.id).set(t.currentProductChecking)}}t.currentProductCheckingIndex++,t.currentProductCheckingIndex<t.productsNotCheckedPrice.length?window.setTimeout(t.doCheckPrice,200):t.getCheckedProducts()}))},decorateData:function(t,e){t.price=parseFloat(t.Price);var r=e.supplierPrices.find((function(t){return"CW"==t.supplier})),n=parseFloat(r&&r.price||0);t.oldPrice=parseFloat(n),t.lastChecked=new Date;var i=t.price;return i>n+.5?(t.priceStatus="increase",t.percentage=((i-n)/n*100).toFixed(0)):i<n-.5?(t.priceStatus="decrease",t.percentage=((n-i)/n*100).toFixed(0)):(t.priceStatus="same",t.percentage=0),{price:parseFloat(t.price),oldPrice:parseFloat(t.oldPrice),lastChecked:t.lastChecked,priceStatus:t.priceStatus,percentage:parseFloat(t.percentage)}},loadCwProducts:function(){var t=this;return this.$fb.productCollection.get().then((function(t){return t.empty?[]:_.map(t.docs,(function(t){return t.data()}))})).then((function(e){return _.filter(e,(function(e){return void 0!=t.getCWProductId(e)}))}))},editProduct:function(t){t.index;var e=t.item;this.$refs.productDetail.open(Object(g["a"])({},e))},productSaved:function(){},forceCheckPriceAgain:function(){this.getOutDateProducts(!0)},filterCheckedProducts:function(){var t=this;this.$nextTick((function(){t.products=[],t.getCheckedProducts()}))},showOnlyDecreaseChange:function(t){t&&(this.filter.showOnlyIncrease=!1),this.filterCheckedProducts()},showOnlyIncreaseChange:function(t){t&&(this.filter.showOnlyDecrease=!1),this.filterCheckedProducts()},getCWProductId:function(t){return((t.supplierPrices||[]).find((function(t){return"CW"==t.supplier}))||{}).id}}},Ln=An,Bn=(r("85d4"),Object(l["a"])(Ln,qn,Rn,!1,null,null,null)),Nn=Bn.exports,Vn=function(){return Promise.all([r.e("chunk-40f4cc33"),r.e("chunk-53869b30")]).then(r.bind(null,"e8c5"))},Qn=function(){return Promise.all([r.e("chunk-40f4cc33"),r.e("chunk-60bac8b0")]).then(r.bind(null,"7277"))};function zn(){return[{path:"/",redirect:"/dashboard",name:"Home",component:Vn,meta:{requiresAuth:!0},children:[{path:"dashboard",name:"Dashboard",component:Qn,meta:{title:"Dashboard",requiresAdmin:!0}},{path:"products",name:"Products",component:Xt,meta:{title:"Products",requiresAdmin:!0}},{path:"inventory",name:"inventory",component:Be,meta:{title:"Inventory",requiresAdmin:!0}},{path:"customers",name:"Customers",component:He,meta:{title:"Customers",requiresAdmin:!0}},{path:"customers/:id/orders",name:"CustomerOrders",component:Xe,meta:{title:"Customer Orders",requiresAdmin:!0}},{path:"orders",name:"Orders",component:ir,meta:{title:"Orders",requiresAdmin:!0},children:[{path:":id/statistic",name:"OrderStatistic",component:ln}]},{path:"orders/:id",name:"OrderDetail",component:Mr,meta:{title:"Order Detail",requiresAdmin:!0}},{path:"orders/:id/collectionpage",name:"OrderDetailCollection",component:Lr,meta:{title:"Order Detail Collection",requiresAdmin:!0}},{path:"orders/:id/shipment",name:"OrderDetailShipment",component:nn,meta:{title:"Order Detail Shipment"}},{path:"trackingPrices",name:"TrackingPrices",component:Nn,meta:{title:"Tracking Prices",requiresAdmin:!0}},{path:"shipments",name:"Shipments",component:jn,meta:{title:"Shipments"}},{path:"utils",name:"UtilsPage",component:vn,meta:{title:"Utils",requiresAdmin:!0}},{path:"settings",name:"SettingsPage",component:kn,meta:{title:"Settings",requiresAdmin:!0}}]},{path:"/login",name:"Login",component:On,meta:{requiresAuth:!1,title:"Login"}}]}i["default"].use(m["a"]);var Wn=new m["a"]({mode:"hash",linkActiveClass:"open active",scrollBehavior:function(){return{y:0}},routes:zn()});Wn.beforeEach((function(t,e,r){var n=f.a.auth().currentUser,i=t.matched.some((function(t){return t.meta.requiresAuth})),s=t.matched.some((function(t){return t.meta.requiresAdmin})),a=!0;document.title=t.matched.reduce((function(t,e){return e.meta.title?e.meta.title:""}),""),i&&!n?r("/login"):s&&!a?r("/shipments"):r()}));var Hn=Wn;r("f576");i["default"].filter("date",(function(t){return(t.getDate()+"").padStart(2,0)+"/"+(t.getMonth()+1+"").padStart(2,0)+"/"+t.getFullYear()})),i["default"].filter("datetime",(function(t){return(t.getDate()+"").padStart(2,0)+"/"+(t.getMonth()+1+"").padStart(2,0)+"/"+t.getFullYear()+" "+(t.getHours()+"").padStart(2,0)+":"+(t.getMinutes()+"").padStart(2,0)})),i["default"].directive("loading",{bind:function(t,e,r){},inserted:function(t,e){},update:function(t,e){var r='<div class="spinner-border spinner-border-sm text-success ml-1" role="status"></div>';e.value?-1==t.innerHTML.indexOf(r)&&(t.innerHTML=t.innerHTML+r,t.disabled=!0):(t.innerHTML=t.innerHTML.replace(r,""),t.disabled=!1)}});var Un=r("bc3a"),Yn=r.n(Un),Kn=(r("e71f"),{apiKey:"AIzaSyBpo4IlT4YWHPf6Kb1ws6KgzfbxQurgPIQ",authDomain:"chemistorder-fac70.firebaseapp.com",databaseURL:"https://chemistorder-fac70.firebaseio.com",projectId:"chemistorder-fac70",storageBucket:"chemistorder-fac70.appspot.com",messagingSenderId:"1018979807432",appId:"1:1018979807432:web:7f91bee1f9f50d792e35fd"});f.a.initializeApp(Kn);var Gn=f.a.firestore(),Jn=f.a.auth(),Xn=Jn.currentUser,Zn=Gn.collection("products"),ti=Gn.collection("customers"),ei=Gn.collection("orders"),ri=Gn.collection("counter"),ni=Gn.collection("inventory"),ii=Gn.collection("distribution"),si=Gn.collection("settings"),ai={db:Gn,auth:Jn,isAdmin:function(){return!0},currentUser:Xn,productCollection:Zn,customerCollection:ti,orderCollection:ei,counterCollection:ri,inventoryCollection:ni,distributionCollection:ii,settingCollection:si},oi=(ai.db.collection("product"),{getProducts:function(t,e,r){var n=this;return this.$fb.productCollection.orderBy("name").startAfter(this.lastVisible||0).limit(this.pageSize).get().then((function(t){t.empty||(n.lastVisible=_.last(t.docs),t.forEach((function(t){n.products.push(t.data())})))}))}}),ci=ai.db.collection("orders");function ui(t){return li.apply(this,arguments)}function li(){return li=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",ci.doc(e).get().then((function(t){return t.data()})));case 1:case"end":return t.stop()}}),t)}))),li.apply(this,arguments)}function di(t){return pi.apply(this,arguments)}function pi(){return pi=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",ci.doc(e).collection("orderItems").get().then((function(t){return 0==t.empty?t.docs.map((function(t){return t.data()})):[]})));case 1:case"end":return t.stop()}}),t)}))),pi.apply(this,arguments)}var mi={getOrderAndItemsByOrderId:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,ui(e);case 2:return r=t.sent,t.next=5,di(e);case 5:return n=t.sent,t.abrupt("return",{order:r,orderItems:n});case 7:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),setOrderItem:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r.id){t.next=6;break}return r.dateModified=new Date,t.next=4,ci.doc(e).collection("orderItems").doc(r.id).set(r);case 4:t.next=11;break;case 6:return r.dateCreated=new Date,n=ci.doc(e).collection("orderItems").doc(),r.id=n.id,t.next=11,n.set(r);case 11:return t.abrupt("return",r);case 12:case"end":return t.stop()}}),t)})));function e(e,r){return t.apply(this,arguments)}return e}(),deleteOrderItem:function(t,e){return ci.doc(t).collection("orderItems").doc(e).delete()},getLast10Orders:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",ci.limit(10).orderBy("dateCreated","desc").get().then((function(t){return t.empty?[]:t.docs.map((function(t){return t.data()}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},hi=ai.db.collection("settings");var fi={getSettings:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={},t.next=3,hi.limit(1).get().then((function(t){return r=t.docs[0].data()}));case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),setSettings:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dateModified=new Date,t.next=3,hi.doc(e.id).set(e);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},vi=ai.db.collection("inventory");function bi(t,e,r){return{date:new Date,message:e,quantity:t.quantity,distributionId:r&&r.id||"",product:{id:t.product.id,name:t.product.name,price:t.product.rndPrice}}}var gi={buildAuditItem:bi,set:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.audit||(e.audit=[]),!e.id){t.next=7;break}return e.audit.push(bi(e,"Update",r)),t.next=5,vi.doc(e.id).set(e);case 5:t.next=12;break;case 7:return e.audit.push(bi(e,"Init")),n=vi.doc(),e.id=n.id,t.next=12,n.set(e);case 12:return t.abrupt("return",e);case 13:case"end":return t.stop()}}),t)})));function e(e,r){return t.apply(this,arguments)}return e}(),get:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,vi.doc(e).get().then((function(t){return t.data()}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},yi=ai.db.collection("distribution");function _i(t,e,r){return{orderId:e.id,orderItemId:r.id,quantity:t.quantity>r.quantity?r.quantity:t.quantity,inventoryId:t.id,date:new Date}}var Ci={buildItem:_i,set:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r,n){var i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=_i(e,r,n),s=yi.doc(),i.id=s.id,t.next=5,s.set(i);case 5:return t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})));function e(e,r,n){return t.apply(this,arguments)}return e}(),delete:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,yi.doc(e).delete();case 2:return t.abrupt("return",!0);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},ki={productService:oi,orderService:mi,settingService:fi,inventoryService:gi,distributionService:Ci},wi=r("7345"),Pi=r.n(wi),xi={counter:void 0},Si={},Ii={getCounter:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.commit,n=e.state,t.abrupt("return",new Promise((function(t,e){n.counter?t(n.counter):(console.log("Get app counter"),ai.counterCollection.limit(1).get().then((function(e){if(e.empty)t(void 0);else{var n=e.docs[0].data();r("setCounter",n),t(n)}})))})));case 2:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),setCounter:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.commit,ai.counterCollection.doc(r.id).set(r).then((function(){n("setCounter",r)}));case 2:case"end":return t.stop()}}),t)})));function e(e,r){return t.apply(this,arguments)}return e}(),increaseCustomerCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter");case 3:n=t.sent,n.customerCount++,r("setCounter",n);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),decreaseCustomerCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter");case 3:n=t.sent,n.customerCount--,r("setCounter",n);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getCustomerCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter").then((function(t){return t.customerCount}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),increaseProductCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter");case 3:n=t.sent,n.productCount++,r("setCounter",n);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),decreaseProductCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter");case 3:n=t.sent,n.productCount--,r("setCounter",n);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getProductCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter").then((function(t){return t.productCount}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),increaseOrderCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter");case 3:n=t.sent,n.orderCount++,r("setCounter",n);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),decreaseOrderCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter");case 3:n=t.sent,n.orderCount--,r("setCounter",n);case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getOrderCount:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.dispatch,t.next=3,r("getCounter").then((function(t){return t.orderCount}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},Oi={setCounter:function(t,e){t.counter=e}},$i={namespaced:!0,state:xi,getters:Si,actions:Ii,mutations:Oi},Ti={orders:[],lastVisible:void 0},Di={},Ei={getAllOrders:function(t){var e=t.commit,r=t.state;return new Promise((function(t,n){r.orders.length>0?(console.log("Get all orders from store"),t(r.orders)):(console.log("Get all orders"),ai.orderCollection.onSnapshot((function(r){if(console.log("update order to store (listen)"),r.empty)e("setOrders",[]),e("setLastVisible",void 0),t([]);else{var n=r.docs.map((function(t){return t.data()})),i=r.docs[r.docs.length-1];e("setOrders",n),e("setLastVisible",i),t(n)}})))}))},getOrderById:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.dispatch,t.next=3,n("getAllOrders");case 3:return t.t0=function(t){return t.id==r},t.abrupt("return",t.sent.find(t.t0));case 5:case"end":return t.stop()}}),t)})));function e(e,r){return t.apply(this,arguments)}return e}(),addOrUpdateOrder:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.dispatch,e.commit,!r.id){t.next=7;break}return r.dateModified=new Date,t.next=5,ai.orderCollection.doc(r.id).set(r);case 5:t.next=12;break;case 7:return r.dateCreated=new Date,n=ai.orderCollection.doc(),r.id=n.id,t.next=12,n.set(r);case 12:return t.abrupt("return",r);case 13:case"end":return t.stop()}}),t)})));function e(e,r){return t.apply(this,arguments)}return e}(),deleteOrder:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},Mi={setOrders:function(t,e){t.orders=e},addOrder:function(t,e){t.orders.push(e)},updateOrder:function(t,e){var r=t.orders.findIndex((function(t){return t.id=e.id}));t.orders.splice(r,1,e)},setLastVisible:function(t,e){t.lastVisible=e}},ji={namespaced:!0,state:Ti,getters:Di,actions:Ei,mutations:Mi};i["default"].use(xt["a"]);var qi=new xt["a"].Store({modules:{counter:$i,order:ji}});window.$=r("1157"),i["default"].prototype.$mapState=xt["c"],i["default"].prototype.$mapActions=xt["b"],i["default"].prototype.$fb=ai,i["default"].prototype.$fbServices=ki,i["default"].prototype.vndConfig={symbol:"VND",thousandsSeparator:",",fractionCount:0,fractionSeparator:".",symbolPosition:"after",symbolSpacing:!0},i["default"].prototype.audConfig={symbol:"$",thousandsSeparator:",",fractionCount:2,fractionSeparator:".",symbolPosition:"front",symbolSpacing:!1},i["default"].prototype.$http=Yn.a,i["default"].use(s["a"]),i["default"].use(Pi.a),i["default"].prototype.showMessage=function(t,e){this.$bvToast.toast(t,{title:e||"Notification",variant:"info",autoHideDelay:2e3})},i["default"].prototype.showError=function(t,e){this.$bvToast.toast(t,{title:e||"Error",variant:"danger",autoHideDelay:2e3})};var Ri="";ai.auth.onAuthStateChanged(Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!ai.auth.currentUser){t.next=6;break}return console.log("Get app settings"),t.next=4,ki.settingService.getSettings().then((function(t){i["default"].prototype.appSettings=t,window.appSettings=t}));case 4:return t.next=6,qi.dispatch("counter/getCounter");case 6:Ri||(Ri=new i["default"]({el:"#app",router:Hn,store:qi,template:"<App/>",components:{App:p}}));case 7:case"end":return t.stop()}}),t)}))))},"5c0b":function(t,e,r){"use strict";var n=r("9c0c"),i=r.n(n);i.a},"6b63":function(t,e,r){"use strict";var n=r("4295"),i=r.n(n);i.a},"85d4":function(t,e,r){"use strict";var n=r("9ebb"),i=r.n(n);i.a},8927:function(t,e,r){},"8f38":function(t,e,r){"use strict";var n=r("97c9"),i=r.n(n);i.a},"908b":function(t,e,r){},"97c9":function(t,e,r){},"9c0c":function(t,e,r){},"9e87":function(t,e,r){"use strict";var n=r("deae"),i=r.n(n);i.a},"9ebb":function(t,e,r){},"9f77":function(t,e,r){"use strict";var n=r("cff5"),i=r.n(n);i.a},a3b2:function(t,e,r){"use strict";var n=r("0846"),i=r.n(n);i.a},b12d:function(t,e,r){"use strict";var n=r("908b"),i=r.n(n);i.a},b96f:function(t,e,r){"use strict";var n=r("ee3b"),i=r.n(n);i.a},bd12:function(t,e,r){"use strict";var n=r("06f4"),i=r.n(n);i.a},cff5:function(t,e,r){},deae:function(t,e,r){},e502:function(t,e,r){"use strict";var n=r("fe77"),i=r.n(n);i.a},ee3b:function(t,e,r){},fe77:function(t,e,r){}});
//# sourceMappingURL=app.cbe9e66a.js.map